# Docker Compose for Base Distroless Images
# Infrastructure configuration for Lucid base images
version: '3.8'

services:
  # Base distroless image
  lucid-base:
    build:
      context: .
      dockerfile: Dockerfile.base.distroless
      platforms:
        - linux/amd64
        - linux/arm64
    image: lucid/base:latest
    container_name: lucid-base-container
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
    healthcheck:
      test: ["python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    networks:
      - lucid-network

  # Minimal base distroless image
  lucid-minimal-base:
    build:
      context: .
      dockerfile: Dockerfile.minimal-base.distroless
      platforms:
        - linux/amd64
        - linux/arm64
    image: lucid/minimal-base:latest
    container_name: lucid-minimal-base-container
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
    healthcheck:
      test: ["python", "-c", "import sys; print('Minimal runtime healthy'); sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    networks:
      - lucid-network

  # ARM64 base distroless image
  lucid-arm64-base:
    build:
      context: .
      dockerfile: Dockerfile.arm64-base.distroless
      platforms:
        - linux/arm64
    image: lucid/arm64-base:latest
    container_name: lucid-arm64-base-container
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
    ports:
      - "8000:8000"
      - "8080:8080"
      - "8443:8443"
      - "9000:9000"
    healthcheck:
      test: ["python", "-c", "import sys; print('ARM64 runtime healthy'); sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    networks:
      - lucid-network

networks:
  lucid-network:
    driver: bridge
    name: lucid-network

volumes:
  lucid-data:
    name: lucid-data
