{
  "name": "Lucid Build Factory - Complete Docker-in-Docker Environment",
  "dockerComposeFile": "docker-compose.dev.yml",
  "service": "devcontainer",
  "workspaceFolder": "/workspaces/Lucid",
  "remoteUser": "root",
  
  // Pre-build setup: Network and Docker preparation
  "initializeCommand": "docker network inspect lucid-dev_lucid_net >nul 2>&1 || docker network create --driver bridge --attachable --subnet=172.20.0.0/16 --gateway=172.20.0.1 lucid-dev_lucid_net",
  
  // Post-creation: Setup buildx and prepare build factory
  "postCreateCommand": [
    "bash",
    "-c",
    "echo 'Configuring Lucid build factory...' && /workspaces/Lucid/.devcontainer/setup-build-factory.sh"
  ],
  
  // Build factory environment variables
  "containerEnv": {
    "DOCKER_BUILDKIT": "1",
    "DOCKER_DEFAULT_PLATFORM": "linux/amd64",
    "COMPOSE_DOCKER_CLI_BUILD": "1",
    "DOCKER_HOST": "unix:///var/run/docker.sock",
    "DOCKER_TLS_CERTDIR": "",
    "PYTHONUNBUFFERED": "1",
    "PYTHONDONTWRITEBYTECODE": "1",
    "PYTHONPATH": "/workspaces/Lucid",
    "LUCID_ENV": "dev",
    "JAVA_HOME": "/usr/lib/jvm/java-17-openjdk-amd64",
    "MAVEN_HOME": "/usr/share/maven",
    "GRADLE_HOME": "/usr/share/gradle",
    "NODE_ENV": "development",
    "SSH_HOST": "pickme@192.168.0.75",
    "SSH_PORT": "22",
    "LUCID_NETWORK": "lucid-dev_lucid_net",
    "LUCID_BUILDER": "lucid-pi"
  },
  
  // Forward development ports
  "forwardPorts": ["2222:2222", 8080, 8081, 9050, 9051],
  
  // Port configuration
  "portsAttributes": {
    "2222": {
      "label": "SSH",
      "onAutoForward": "ignore"
    },
    "8080": {
      "label": "API Gateway",
      "onAutoForward": "openPreview"
    },
    "8081": {
      "label": "API Server",
      "onAutoForward": "openPreview"
    },
    "9050": {
      "label": "Tor SOCKS",
      "onAutoForward": "ignore"
    },
    "9051": {
      "label": "Tor Control",
      "onAutoForward": "ignore"
    }
  },
  
  // VS Code customizations
  "customizations": {
    "vscode": {
      "extensions": [
        // Python development
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-python.mypy-type-checker",
        "astral-sh.ruff",
        "ms-python.black-formatter",
        "ms-python.pytest",
        
        // Java development
        "redhat.java",
        "vscjava.vscode-java-pack",
        "vscjava.vscode-maven",
        "vscjava.vscode-gradle",
        "vscjava.vscode-java-test",
        "vscjava.vscode-java-debug",
        
        // Docker and containers
        "ms-azuretools.vscode-docker",
        "ms-vscode-remote.remote-containers",
        
        // Configuration files
        "redhat.vscode-yaml",
        "ms-vscode.vscode-json",
        "tamasfe.even-better-toml",
        
        // Development tools
        "eamodio.gitlens",
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "ms-vscode.test-adapter-converter",
        
        // Security and cryptography
        "ms-vscode.hexeditor"
      ],
      
      "settings": {
        // Python configuration
        "python.defaultInterpreterPath": "/usr/bin/python3",
        "python.linting.enabled": true,
        "python.linting.ruffEnabled": true,
        "python.formatting.provider": "black",
        "python.testing.pytestEnabled": true,
        "python.testing.pytestArgs": ["tests"],
        
        // Java configuration
        "java.home": "/usr/lib/jvm/java-17-openjdk-amd64",
        "java.configuration.runtimes": [
          {
            "name": "JavaSE-17",
            "path": "/usr/lib/jvm/java-17-openjdk-amd64",
            "default": true
          }
        ],
        "java.compile.nullAnalysis.mode": "automatic",
        "maven.executable.path": "/usr/bin/mvn",
        
        // Docker configuration
        "docker.dockerPath": "/usr/bin/docker",
        "docker.composeCommand": "docker-compose",
        
        // Terminal configuration
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.cwd": "/workspaces/Lucid",
        
        // File associations
        "files.associations": {
          "*.env*": "dotenv",
          "docker-compose*.yml": "yaml",
          "docker-compose*.yaml": "yaml"
        },
        
        // Editor configuration
        "editor.formatOnSave": true,
        "editor.codeActionsOnSave": {
          "source.organizeImports": true
        },
        
        // Python-specific formatting
        "[python]": {
          "editor.defaultFormatter": "ms-python.black-formatter",
          "editor.formatOnSave": true,
          "editor.codeActionsOnSave": {
            "source.organizeImports": true
          }
        },
        
        // Ruff configuration
        "ruff.organizeImports": true,
        "mypy-type-checker.importStrategy": "fromEnvironment"
      }
    }
  },
  
  // Development features - minimal for DinD
  "features": {
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": false,
      "installOhMyZsh": false,
      "upgradePackages": true,
      "username": "root"
    }
  }
}
