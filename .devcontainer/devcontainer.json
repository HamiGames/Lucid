{
  "name": "Lucid Build Factory - Complete Docker-in-Docker Environment",
  "dockerComposeFile": "docker-compose.dev.yml",
  "service": "devcontainer",
  "workspaceFolder": "/mnt/myssd/Lucid/Lucid",
  "remoteUser": "root",
  
  "initializeCommand": [
    "powershell.exe",
    "-Command",
    "docker network inspect lucid-dev_lucid_net 2>$null || docker network create --driver bridge --attachable --subnet=172.20.0.0/16 --gateway=172.20.0.1 lucid-dev_lucid_net"
  ],
  
  "postCreateCommand": [
    "bash",
    "-c",
    "echo 'Configuring Lucid build factory...' && if [ -f /mnt/myssd/Lucid/Lucid/scripts/devcontainer/setup-build-factory.sh ]; then /mnt/myssd/Lucid/Lucid/scripts/devcontainer/setup-build-factory.sh; else echo 'Setup script not found, continuing...'; fi"
  ],
  
  "containerEnv": {
    "DOCKER_BUILDKIT": "1",
    "DOCKER_DEFAULT_PLATFORM": "linux/amd64",
    "COMPOSE_DOCKER_CLI_BUILD": "1",
    "DOCKER_HOST": "unix:///var/run/docker.sock",
    "DOCKER_TLS_CERTDIR": "",
    "PYTHONUNBUFFERED": "1",
    "PYTHONDONTWRITEBYTECODE": "1",
    "PYTHONPATH": "/mnt/myssd/Lucid",
    "LUCID_ENV": "dev",
    "JAVA_HOME": "/usr/lib/jvm/java-17-openjdk-amd64",
    "MAVEN_HOME": "/usr/share/maven",
    "GRADLE_HOME": "/usr/share/gradle",
    "NODE_ENV": "development",
    "SSH_HOST": "pickme@192.168.0.75",
    "SSH_PORT": "22",
    "LUCID_NETWORK": "lucid-dev_lucid_net",
    "LUCID_BUILDER": "lucid-pi",
    "MONGO_URL": "mongodb://lucid:lucid@lucid_mongo:27017/lucid?authSource=admin&retryWrites=false",
    "SERVICE_NAME": "lucid-api",
    "VERSION": "0.1.0",
    "PORT": "8081"
  },
  
  "forwardPorts": [2222, 8080, 8081, 8082, 9050, 9051, 27017],
  
  "portsAttributes": {
    "2222": {
      "label": "SSH",
      "onAutoForward": "ignore"
    },
    "8080": {
      "label": "API Gateway",
      "onAutoForward": "openPreview"
    },
    "8081": {
      "label": "API Server",
      "onAutoForward": "openPreview"
    },
    "8082": {
      "label": "Blockchain Core",
      "onAutoForward": "openPreview"
    },
    "9050": {
      "label": "Tor SOCKS",
      "onAutoForward": "ignore"
    },
    "9051": {
      "label": "Tor Control",
      "onAutoForward": "ignore"
    },
    "27017": {
      "label": "MongoDB",
      "onAutoForward": "ignore"
    }
  },
  
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-python.mypy-type-checker",
        "astral-sh.ruff",
        "ms-python.black-formatter",
        "ms-python.pytest",
        "redhat.java",
        "vscjava.vscode-java-pack",
        "vscjava.vscode-maven",
        "vscjava.vscode-gradle",
        "vscjava.vscode-java-test",
        "vscjava.vscode-java-debug",
        "ms-azuretools.vscode-docker",
        "ms-vscode-remote.remote-containers",
        "redhat.vscode-yaml",
        "ms-vscode.vscode-json",
        "tamasfe.even-better-toml",
        "eamodio.gitlens",
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "ms-vscode.test-adapter-converter",
        "ms-vscode.hexeditor",
        "ms-python.isort",
        "ms-python.flake8",
        "ms-toolsai.jupyter",
        "ms-toolsai.jupyter-keymap",
        "ms-toolsai.jupyter-renderers",
        "ms-vscode.powershell",
        "ms-vscode-remote.remote-ssh",
        "ms-vscode-remote.remote-ssh-edit"
      ],
      
      "settings": {
        "python.defaultInterpreterPath": "/usr/bin/python3",
        "python.linting.enabled": true,
        "python.linting.ruffEnabled": true,
        "python.formatting.provider": "black",
        "python.testing.pytestEnabled": true,
        "python.testing.pytestArgs": ["tests"],
        "python.testing.cwd": "/mnt/myssd/Lucid/Lucid",
        "java.home": "/usr/lib/jvm/java-17-openjdk-amd64",
        "java.configuration.runtimes": [
          {
            "name": "JavaSE-17",
            "path": "/usr/lib/jvm/java-17-openjdk-amd64",
            "default": true
          }
        ],
        "java.compile.nullAnalysis.mode": "automatic",
        "maven.executable.path": "/usr/bin/mvn",
        "docker.dockerPath": "/usr/bin/docker",
        "docker.composeCommand": "docker-compose",
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.cwd": "/mnt/myssd/Lucid/Lucid",
        "files.associations": {
          "*.env*": "dotenv",
          "docker-compose*.yml": "yaml",
          "docker-compose*.yaml": "yaml",
          "*.toml": "toml",
          "*.yaml": "yaml",
          "*.yml": "yaml"
        },
        "editor.formatOnSave": true,
        "editor.codeActionsOnSave": {
          "source.organizeImports": true,
          "source.fixAll.ruff": true
        },
        "[python]": {
          "editor.defaultFormatter": "ms-python.black-formatter",
          "editor.formatOnSave": true,
          "editor.codeActionsOnSave": {
            "source.organizeImports": true,
            "source.fixAll.ruff": true
          }
        },
        "[yaml]": {
          "editor.defaultFormatter": "redhat.vscode-yaml",
          "editor.formatOnSave": true
        },
        "[json]": {
          "editor.defaultFormatter": "ms-vscode.vscode-json",
          "editor.formatOnSave": true
        },
        "ruff.organizeImports": true,
        "ruff.lint.enable": true,
        "ruff.format.enable": true,
        "mypy-type-checker.importStrategy": "fromEnvironment",
        "files.exclude": {
          "**/__pycache__": true,
          "**/*.pyc": true,
          "**/.pytest_cache": true,
          "**/node_modules": true,
          "**/.git": false
        },
        "search.exclude": {
          "**/__pycache__": true,
          "**/*.pyc": true,
          "**/.pytest_cache": true,
          "**/node_modules": true,
          "**/build": true,
          "**/dist": true
        },
        "git.ignoreLimitWarning": true,
        "git.autofetch": true,
        "git.enableSmartCommit": true,
        "docker.showStartPage": false,
        "docker.defaultRegistryPath": "pickme/lucid",
        "powershell.promptToUpdatePowerShell": false,
        "terminal.integrated.env.linux": {
          "PYTHONPATH": "/mnt/myssd/Lucid/Lucid",
          "DOCKER_BUILDKIT": "1",
          "LUCID_ENV": "dev"
        }
      }
    }
  },
  
  "features": {
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": false,
      "installOhMyZsh": false,
      "upgradePackages": true,
      "username": "root"
    },
    "ghcr.io/devcontainers/features/git:1": {
      "ppa": true,
      "version": "latest"
    },
    "ghcr.io/devcontainers/features/github-cli:1": {
      "installDirectlyFromGitHubRelease": true,
      "version": "latest"
    }
  },
  
  "mounts": [
    "source=${localWorkspaceFolder},target=/mnt/myssd/Lucid/Lucid,type=bind,consistency=cached",
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind",
    "source=lucid-devcontainer_docker_data,target=/var/lib/docker,type=volume",
    "source=lucid-devcontainer_buildx_data,target=/root/.docker/buildx,type=volume"
  ],
  
  "runArgs": [
    "--privileged",
    "--security-opt=seccomp:unconfined",
    "--security-opt=apparmor:unconfined",
    "--platform=linux/amd64"
  ],
  
  "overrideCommand": false,
  
  "shutdownAction": "stopCompose",
  
  "updateContentCommand": "echo 'Updating development environment...' && pip install -e .",
  
  "postStartCommand": [
    "bash",
    "-c",
    "echo 'Starting Lucid development environment...' && docker buildx ls | grep -q lucid-pi || docker buildx create --name lucid-pi --use --driver docker-container --driver-opt network=host"
  ]
}
