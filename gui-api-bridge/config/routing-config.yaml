# Lucid GUI API Bridge - Routing Configuration
# File: gui-api-bridge/config/routing-config.yaml
# Purpose: Define routing rules, upstream services, and load balancing
# Aligned with 03-api-gateway/config/routing-config.yaml

# Global Routing Configuration
global:
  default_timeout_seconds: 30
  max_retries: 3
  retry_delay_seconds: 1
  health_check_interval_seconds: 30
  circuit_breaker_enabled: true
  circuit_breaker_failure_threshold: 5
  circuit_breaker_success_threshold: 2
  circuit_breaker_timeout_seconds: 60

# Upstream Services Configuration
upstream_services:
  api_gateway:
    url: "http://lucid-api-gateway:8080"
    timeout_seconds: 30
    max_connections: 1000
    health_check:
      enabled: true
      path: "/api/v1/meta/health"
      interval_seconds: 30
      timeout_seconds: 5
      unhealthy_threshold: 3
      healthy_threshold: 2
    load_balancing:
      strategy: "round_robin"
      weight: 100
    retry:
      enabled: true
      max_attempts: 3
      retry_on: ["5xx", "timeout", "connect_failure"]
      backoff_multiplier: 2

  blockchain_engine:
    url: "http://lucid-blockchain-engine:8084"
    timeout_seconds: 60
    max_connections: 500
    health_check:
      enabled: true
      path: "/health"
      interval_seconds: 30
    load_balancing:
      strategy: "round_robin"
      weight: 100
    retry:
      enabled: true
      max_attempts: 3
      retry_on: ["5xx", "timeout"]

  auth_service:
    url: "http://lucid-auth-service:8089"
    timeout_seconds: 30
    max_connections: 1000
    health_check:
      enabled: true
      path: "/health"
      interval_seconds: 30
    load_balancing:
      strategy: "round_robin"
      weight: 100

  session_api:
    url: "http://lucid-session-api:8087"
    timeout_seconds: 30
    max_connections: 1000
    health_check:
      enabled: true
      path: "/health"
      interval_seconds: 30
    load_balancing:
      strategy: "round_robin"
      weight: 100

  node_management:
    url: "http://lucid-node-management:8095"
    timeout_seconds: 30
    max_connections: 500
    health_check:
      enabled: true
      path: "/health"
      interval_seconds: 30
    load_balancing:
      strategy: "round_robin"
      weight: 100

  admin_interface:
    url: "http://lucid-admin-interface:8083"
    timeout_seconds: 30
    max_connections: 500
    health_check:
      enabled: true
      path: "/health"
      interval_seconds: 30
    load_balancing:
      strategy: "round_robin"
      weight: 100

  tron_payment:
    url: "http://lucid-tron-client:8091"
    timeout_seconds: 60
    max_connections: 200
    health_check:
      enabled: true
      path: "/health"
      interval_seconds: 30
    load_balancing:
      strategy: "round_robin"
      weight: 100

# Route Definitions
routes:
  # User Routes
  - path: "/api/v1/user/*"
    upstream: null  # Handled by GUI API Bridge directly
    methods: ["GET", "POST", "PUT", "DELETE", "PATCH"]
    authentication_required: true
    rate_limit:
      enabled: true
      requests_per_minute: 1000
      burst_size: 100
    timeout_seconds: 30

  # Developer Routes
  - path: "/api/v1/developer/*"
    upstream: null  # Handled by GUI API Bridge directly
    methods: ["GET", "POST", "PUT", "DELETE", "PATCH"]
    authentication_required: true
    rate_limit:
      enabled: true
      requests_per_minute: 5000
      burst_size: 500
    timeout_seconds: 30

  # Node Operator Routes
  - path: "/api/v1/node/*"
    upstream: null  # Handled by GUI API Bridge directly
    methods: ["GET", "POST", "PUT"]
    authentication_required: true
    rate_limit:
      enabled: true
      requests_per_minute: 5000
      burst_size: 500
    timeout_seconds: 30

  # Admin Routes
  - path: "/api/v1/admin/*"
    upstream: null  # Handled by GUI API Bridge directly
    methods: ["GET", "POST", "PUT", "DELETE"]
    authentication_required: true
    rate_limit:
      enabled: true
      requests_per_minute: 10000
      burst_size: 1000
    timeout_seconds: 30

  # Health Check Routes (No upstream)
  - path: "/health"
    upstream: null
    methods: ["GET"]
    authentication_required: false
    rate_limit:
      enabled: false
    timeout_seconds: 5

  - path: "/api/v1"
    upstream: null
    methods: ["GET"]
    authentication_required: false
    rate_limit:
      enabled: false
    timeout_seconds: 5

  # WebSocket Routes
  - path: "/ws"
    upstream: null
    methods: ["GET"]
    authentication_required: true
    rate_limit:
      enabled: false
    timeout_seconds: -1  # No timeout for WebSocket

# Path Rewriting Rules
path_rewrites: []

# Request/Response Transformation
transformations:
  request_headers:
    - name: "X-Forwarded-For"
      value: "$remote_addr"
    - name: "X-Real-IP"
      value: "$remote_addr"
    - name: "X-Forwarded-Proto"
      value: "$scheme"
    - name: "X-Request-ID"
      value: "$request_id"
  
  response_headers:
    - name: "X-Request-ID"
      value: "$request_id"
    - name: "X-Service-Name"
      value: "gui-api-bridge"

# Caching Configuration
caching:
  enabled: true
  default_ttl_seconds: 300
  max_cache_size_mb: 50
  cache_key_strategy: "path_and_query"
  cacheable_methods: ["GET"]
  cacheable_paths: []
  no_cache_headers:
    - "Authorization"
    - "X-No-Cache"

# Security Headers
security_headers:
  enabled: true
  headers:
    - name: "X-Content-Type-Options"
      value: "nosniff"
    - name: "X-Frame-Options"
      value: "DENY"
    - name: "X-XSS-Protection"
      value: "1; mode=block"
    - name: "Strict-Transport-Security"
      value: "max-age=31536000; includeSubDomains"
    - name: "Content-Security-Policy"
      value: "default-src 'self'"

# Error Handling
error_handling:
  default_error_pages: {}
  error_response_format: "json"
  include_stack_trace: false
  log_errors: true

# Monitoring and Observability
monitoring:
  enabled: true
  metrics:
    enabled: true
    endpoint: "/metrics"
    include_upstream_metrics: true
  
  tracing:
    enabled: false
    provider: "jaeger"
    sampling_rate: 0.1
  
  logging:
    enabled: true
    format: "json"
    level: "INFO"
    include_request_body: false
    include_response_body: false
    sensitive_headers: ["Authorization", "Cookie", "X-Auth-Token"]
