# Lucid Node Management - Node Management Configuration
# Optional YAML configuration for node management service
# File: node/config/node-management-config.yaml
# Purpose: Define node pool management, PoOT consensus, and payout policies
# NOTE: All service URLs, ports, and database connections must be provided via
# environment variables from docker-compose.application.yml

# Global Node Management Configuration
global:
  service_name: "lucid-node-management"
  service_version: "1.0.0"
  debug: false
  log_level: "INFO"  # Override with LOG_LEVEL env var
  host: "0.0.0.0"  # Bind address (always 0.0.0.0 in container)
  # Network configuration from environment:
  # - NODE_MANAGEMENT_HOST (default: node-management)
  # - NODE_MANAGEMENT_PORT (default: 8095)
  # - NODE_MANAGEMENT_URL (default: http://node-management:8095)
  port: 8095  # Override with NODE_MANAGEMENT_PORT env var
  staging_port: 8099

# Node Pool Configuration
node_pool:
  # Pool Limits
  limits:
    max_nodes_per_pool: 100
    min_nodes_per_pool: 1
    max_pools: 10
  
  # Pool Management
  management:
    auto_join_enabled: true
    auto_leave_enabled: false
    pool_health_check_interval_seconds: 120
    pool_sync_interval_seconds: 30
    pool_join_timeout_seconds: 60
  
  # Pool Selection
  selection:
    strategy: "round_robin"  # Options: round_robin, least_loaded, random, geographic
    consider_load: true
    consider_uptime: true
    consider_reputation: true

# PoOT (Proof of Operational Time) Configuration
poot:
  enabled: true
  calculation_interval_seconds: 300  # 5 minutes
  score_threshold: 0.5
  history_days: 30
  
  # PoOT Factors
  factors:
    operational_time_weight: 0.4
    stake_amount_weight: 0.3
    reputation_score_weight: 0.2
    network_contribution_weight: 0.1
  
  # Operational Time Calculation
  operational_time:
    min_uptime_percentage: 0.95  # 95% uptime required
    measurement_interval_seconds: 60
    history_retention_days: 30
  
  # Validation
  validation:
    enabled: true
    validate_uptime: true
    validate_stake: true
    validate_reputation: true
    validation_interval_seconds: 300

# Work Credits System
work_credits:
  enabled: true
  credit_earn_rate: 1.0  # Credits per second of operational time
  credit_decay_rate: 0.01  # Credits decay per day
  min_credits_for_validation: 100
  max_credits: 10000
  credit_history_days: 30

# Staking Configuration
staking:
  enabled: true
  minimum_stake_amount: 1000  # Minimum TRX or tokens required
  staking_period_days: 30
  unstaking_cooldown_days: 7
  reward_distribution:
    method: "proportional"  # Options: proportional, fixed, performance_based
    distribution_interval_blocks: 100
    reward_per_block: 10

# Payout Configuration
payout:
  enabled: true
  processing_interval_seconds: 3600  # 1 hour
  minimum_amount_usdt: 10.0
  batch_size: 10
  payout_method: "tron"  # Options: tron, ethereum, manual
  
  # Payout Processing
  processing:
    enabled: true
    auto_process: true
    require_confirmation: true
    confirmation_blocks: 6
  
  # Payout Limits
  limits:
    max_payout_amount_usdt: 10000.0
    max_payouts_per_day: 100
    max_payouts_per_user_per_day: 10
  
  # Payout Fees
  fees:
    enabled: true
    fee_percentage: 0.01  # 1%
    min_fee_usdt: 0.1
    max_fee_usdt: 10.0

# Resource Monitoring
resource_monitoring:
  enabled: true
  monitoring_interval_seconds: 30
  resource_collection_interval_seconds: 10
  
  # Resource Thresholds
  thresholds:
    cpu_percent: 80.0
    memory_percent: 80.0
    disk_percent: 85.0
    network_bandwidth_mbps: 100.0
  
  # Resource Limits
  limits:
    max_cpu_percent: 100.0
    max_memory_mb: 2048
    max_disk_gb: 100.0
    max_bandwidth_mbps: 1000.0

# Database Configuration
# NOTE: Database URLs MUST come from environment variables:
# - MONGODB_URL or MONGODB_URI (required, from .env.secrets)
# - REDIS_URL or REDIS_URI (from .env.core or .env.secrets)
database:
  mongodb_url: ""  # Set via MONGODB_URL or MONGODB_URI env var (required)
  mongodb_database: ""  # Set via MONGODB_DATABASE env var (default: lucid_node_management)
  redis_url: ""    # Set via REDIS_URL or REDIS_URI env var

# External Service URLs
# NOTE: Service URLs MUST come from environment variables:
# - API_GATEWAY_URL (from docker-compose.core.yml)
# - BLOCKCHAIN_ENGINE_URL (from docker-compose.core.yml)
external_services:
  api_gateway_url: ""  # Set via API_GATEWAY_URL env var (http://api-gateway:8080)
  blockchain_engine_url: ""  # Set via BLOCKCHAIN_ENGINE_URL env var (http://blockchain-engine:8084)

# Monitoring Configuration
monitoring:
  enabled: true
  metrics_enabled: true
  metrics_port: 9090
  health_check_interval: 30  # seconds
  prometheus_enabled: true
  jaeger_enabled: false
  jaeger_endpoint: null

# Error Handling
error_handling:
  retry_policies:
    max_retries: 3
    retry_delay_seconds: 1
    exponential_backoff: true
    backoff_multiplier: 2
  
  failure_handling:
    log_failures: true
    notify_on_failure: false
    queue_failed_items: true
    retry_failed_items: true
    max_retry_attempts: 5

# Security Configuration
security:
  access_control:
    require_authentication: true
    require_authorization: true
    allowed_roles: ["NODE_OPERATOR", "ADMIN", "SUPER_ADMIN"]
  
  data_privacy:
    encrypt_sensitive_data: false
    audit_log_enabled: true
    audit_log_retention_days: 90
    mask_data_in_logs: true