version: '3.8'

services:
  admin-interface:
    image: pickme/lucid-admin-interface:latest-arm64
    container_name: admin-interface
    restart: unless-stopped
    networks:
      - lucid-pi-network
    ports:
      - "8120:8120"
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - ADMIN_INTERFACE_HOST=admin-interface
      - ADMIN_INTERFACE_PORT=8120
      - ADMIN_INTERFACE_URL=http://admin-interface:8120
      - MONGODB_URL=${MONGODB_URL}
      - REDIS_URL=${REDIS_URL}
      - AUTH_SERVICE_URL=${AUTH_SERVICE_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=admin-interface"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"

  tron-client:
    image: pickme/lucid-tron-client:latest-arm64
    container_name: tron-client
    restart: unless-stopped
    networks:
      - lucid-tron-isolated
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_CLIENT_HOST=tron-client
      - TRON_CLIENT_PORT=8091
      - TRON_CLIENT_URL=http://tron-client:8091
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - MONGODB_URL=${MONGODB_URL}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8091/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-client"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"

  tron-payout-router:
    image: pickme/lucid-tron-payout-router:latest-arm64
    container_name: tron-payout-router
    restart: unless-stopped
    networks:
      - lucid-tron-isolated
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - MONGODB_URL=${MONGODB_URL}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-payout-router"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"

  tron-wallet-manager:
    image: pickme/lucid-tron-wallet-manager:latest-arm64
    container_name: tron-wallet-manager
    restart: unless-stopped
    networks:
      - lucid-tron-isolated
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - MONGODB_URL=${MONGODB_URL}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-wallet-manager"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"

  tron-usdt-manager:
    image: pickme/lucid-tron-usdt-manager:latest-arm64
    container_name: tron-usdt-manager
    restart: unless-stopped
    networks:
      - lucid-tron-isolated
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - USDT_CONTRACT_ADDRESS=${USDT_CONTRACT_ADDRESS}
      - USDT_DECIMALS=${USDT_DECIMALS}
      - MONGODB_URL=${MONGODB_URL}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-usdt-manager"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"

  tron-staking:
    image: pickme/lucid-tron-staking:latest-arm64
    container_name: tron-staking
    restart: unless-stopped
    networks:
      - lucid-tron-isolated
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - MONGODB_URL=${MONGODB_URL}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-staking"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"

  tron-payment-gateway:
    image: pickme/lucid-tron-payment-gateway:latest-arm64
    container_name: tron-payment-gateway
    restart: unless-stopped
    networks:
      - lucid-tron-isolated
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - USDT_CONTRACT_ADDRESS=${USDT_CONTRACT_ADDRESS}
      - USDT_DECIMALS=${USDT_DECIMALS}
      - MONGODB_URL=${MONGODB_URL}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-payment-gateway"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"

networks:
  lucid-pi-network:
    external: true
    name: lucid-pi-network
  lucid-tron-isolated:
    external: true
    name: lucid-tron-isolated