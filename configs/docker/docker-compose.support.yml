# Phase 4 Support Services - Docker Compose Configuration
# Step 45: Docker Compose Configurations - Support Phase
# Includes: Admin Interface, TRON Payment Services

version: '3.8'

services:
  # ===========================================
  # ADMIN INTERFACE SERVICES
  # ===========================================
  
  # Admin Interface
  admin-interface:
    image: ${LUCID_REGISTRY:-ghcr.io}/${LUCID_IMAGE_NAME:-HamiGames/Lucid}/admin-interface:${LUCID_TAG:-latest}
    container_name: lucid-admin-interface
    restart: unless-stopped
    ports:
      - "8083:8083"
    environment:
      - SERVICE_NAME=lucid-admin-interface
      - PORT=8083
      - HOST=0.0.0.0
      - LOG_LEVEL=INFO
      - DEBUG=false
      - MONGODB_URI=mongodb://lucid:lucid@lucid-mongodb:27017/lucid?authSource=admin
      - REDIS_URI=redis://lucid-redis:6379/0
      - RBAC_ENABLED=true
      - AUDIT_LOGGING_ENABLED=true
      - EMERGENCY_CONTROLS_ENABLED=true
    volumes:
      - /mnt/myssd/Lucid/Lucid/logs/admin-interface:/app/logs
      - /mnt/myssd/Lucid/Lucid/data/admin-interface:/app/data
    networks:
      - lucid-dev
    depends_on:
      lucid-mongodb:
        condition: service_healthy
      lucid-redis:
        condition: service_healthy
      lucid-api-gateway:
        condition: service_healthy
      lucid-blocks:
        condition: service_healthy
      lucid-session-api:
        condition: service_healthy
      lucid-node-management:
        condition: service_healthy
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8083/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      - "com.lucid.phase=support"
      - "com.lucid.service=admin-interface"
      - "com.lucid.cluster=06-admin-interface"

  # ===========================================
  # TRON PAYMENT SERVICES (6 containers)
  # ===========================================

  # TRON Client
  tron-client:
    image: pickme/lucid-tron-client:latest-arm64
    container_name: lucid-tron-client
    restart: unless-stopped
    ports:
      - "8091:8091"
    environment:
      - SERVICE_NAME=lucid-tron-client
      - PORT=8091
      - HOST=0.0.0.0
      - LOG_LEVEL=INFO
      - DEBUG=false
      - TRON_NETWORK=${TRON_NETWORK:-shasta}
      - TRON_MAINNET_URL=${TRON_MAINNET_URL:-https://api.trongrid.io}
      - TRON_TESTNET_URL=${TRON_TESTNET_URL:-https://api.shasta.trongrid.io}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
    volumes:
      - /mnt/myssd/Lucid/Lucid/logs/tron-client:/app/logs
      - /mnt/myssd/Lucid/Lucid/data/tron-client:/app/data
    networks:
      - lucid-tron-isolated
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8091/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      - "com.lucid.phase=support"
      - "com.lucid.service=tron-client"
      - "com.lucid.cluster=07-tron-payment"

  # TRON Payout Router
  tron-payout-router:
    image: pickme/lucid-payout-router:latest-arm64
    container_name: lucid-tron-payout-router
    restart: unless-stopped
    ports:
      - "8092:8092"
    environment:
      - SERVICE_NAME=lucid-tron-payout-router
      - PORT=8092
      - HOST=0.0.0.0
      - LOG_LEVEL=INFO
      - DEBUG=false
      - TRON_CLIENT_URL=http://lucid-tron-client:8091
      - PAYOUT_V0_ENABLED=true
      - PAYOUT_KYC_ENABLED=true
    volumes:
      - /mnt/myssd/Lucid/Lucid/logs/tron-payout-router:/app/logs
      - /mnt/myssd/Lucid/Lucid/data/tron-payout-router:/app/data
    networks:
      - lucid-tron-isolated
    depends_on:
      lucid-tron-client:
        condition: service_healthy
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8092/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      - "com.lucid.phase=support"
      - "com.lucid.service=tron-payout-router"
      - "com.lucid.cluster=07-tron-payment"

  # TRON Wallet Manager
  tron-wallet-manager:
    image: pickme/lucid-wallet-manager:latest-arm64
    container_name: lucid-tron-wallet-manager
    restart: unless-stopped
    ports:
      - "8093:8093"
    environment:
      - SERVICE_NAME=lucid-tron-wallet-manager
      - PORT=8093
      - HOST=0.0.0.0
      - LOG_LEVEL=INFO
      - DEBUG=false
      - TRON_CLIENT_URL=http://lucid-tron-client:8091
      - WALLET_ENCRYPTION_ENABLED=true
    volumes:
      - /mnt/myssd/Lucid/Lucid/logs/tron-wallet-manager:/app/logs
      - /mnt/myssd/Lucid/Lucid/data/tron-wallet-manager:/app/data
    networks:
      - lucid-tron-isolated
    depends_on:
      lucid-tron-client:
        condition: service_healthy
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8093/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      - "com.lucid.phase=support"
      - "com.lucid.service=tron-wallet-manager"
      - "com.lucid.cluster=07-tron-payment"

  # TRON USDT Manager
  tron-usdt-manager:
    image: pickme/lucid-usdt-manager:latest-arm64
    container_name: lucid-tron-usdt-manager
    restart: unless-stopped
    ports:
      - "8094:8094"
    environment:
      - SERVICE_NAME=lucid-tron-usdt-manager
      - PORT=8094
      - HOST=0.0.0.0
      - LOG_LEVEL=INFO
      - DEBUG=false
      - TRON_CLIENT_URL=http://lucid-tron-client:8091
      - USDT_TRC20_ADDRESS=${USDT_TRC20_ADDRESS:-TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs}
    volumes:
      - /mnt/myssd/Lucid/Lucid/logs/tron-usdt-manager:/app/logs
      - /mnt/myssd/Lucid/Lucid/data/tron-usdt-manager:/app/data
    networks:
      - lucid-tron-isolated
    depends_on:
      lucid-tron-client:
        condition: service_healthy
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8094/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      - "com.lucid.phase=support"
      - "com.lucid.service=tron-usdt-manager"
      - "com.lucid.cluster=07-tron-payment"

  # TRON Staking Service
  tron-staking:
    image: pickme/lucid-trx-staking:latest-arm64
    container_name: lucid-tron-staking
    restart: unless-stopped
    ports:
      - "8095:8095"
    environment:
      - SERVICE_NAME=lucid-tron-staking
      - PORT=8095
      - HOST=0.0.0.0
      - LOG_LEVEL=INFO
      - DEBUG=false
      - TRON_CLIENT_URL=http://lucid-tron-client:8091
      - STAKING_ENABLED=true
      - STAKING_REWARDS_ENABLED=true
    volumes:
      - /mnt/myssd/Lucid/Lucid/logs/tron-staking:/app/logs
      - /mnt/myssd/Lucid/Lucid/data/tron-staking:/app/data
    networks:
      - lucid-tron-isolated
    depends_on:
      lucid-tron-client:
        condition: service_healthy
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8095/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      - "com.lucid.phase=support"
      - "com.lucid.service=tron-staking"
      - "com.lucid.cluster=07-tron-payment"

  # TRON Payment Gateway
  tron-payment-gateway:
    image: pickme/lucid-payment-gateway:latest-arm64
    container_name: lucid-tron-payment-gateway
    restart: unless-stopped
    ports:
      - "8096:8096"
    environment:
      - SERVICE_NAME=lucid-tron-payment-gateway
      - PORT=8096
      - HOST=0.0.0.0
      - LOG_LEVEL=INFO
      - DEBUG=false
      - TRON_CLIENT_URL=http://lucid-tron-client:8091
      - PAYOUT_ROUTER_URL=http://lucid-tron-payout-router:8092
      - WALLET_MANAGER_URL=http://lucid-tron-wallet-manager:8093
      - USDT_MANAGER_URL=http://lucid-tron-usdt-manager:8094
      - STAKING_URL=http://lucid-tron-staking:8095
    volumes:
      - /mnt/myssd/Lucid/Lucid/logs/tron-payment-gateway:/app/logs
      - /mnt/myssd/Lucid/Lucid/data/tron-payment-gateway:/app/data
    networks:
      - lucid-tron-isolated
    depends_on:
      lucid-tron-client:
        condition: service_healthy
      lucid-tron-payout-router:
        condition: service_healthy
      lucid-tron-wallet-manager:
        condition: service_healthy
      lucid-tron-usdt-manager:
        condition: service_healthy
      lucid-tron-staking:
        condition: service_healthy
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8096/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    labels:
      - "com.lucid.phase=support"
      - "com.lucid.service=tron-payment-gateway"
      - "com.lucid.cluster=07-tron-payment"

# ===========================================
# NETWORKS
# ===========================================
networks:
  lucid-dev:
    name: lucid-dev_lucid_net
    driver: bridge
    attachable: true
    ipam:
      config:
        - subnet: 172.20.0.0/16
          gateway: 172.20.0.1
  
  # Isolated network for TRON services
  lucid-tron-isolated:
    name: lucid-tron-isolated
    driver: bridge
    attachable: true
    ipam:
      config:
        - subnet: 172.21.0.0/16
          gateway: 172.21.0.1

# ===========================================
# VOLUMES
# ===========================================
# =============================================================================
# VOLUMES - Using Direct Host Paths on Pi
# =============================================================================
# All volumes are mounted directly to /mnt/myssd/Lucid on the Pi
# No named volumes needed - using host path mounts for better performance
