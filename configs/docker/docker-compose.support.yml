name: lucid-support
services:
  admin-interface:
    image: ${ADMIN_INTERFACE_IMAGE:-pickme/lucid-admin-interface:latest-arm64}
    container_name: lucid-admin-interface
    restart: unless-stopped
    env_file:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.foundation
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.support
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.secrets
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.core
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.application
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.admin-interface
    networks:
      - lucid-pi-network
    ports:
      - "${ADMIN_INTERFACE_PORT:-8083}:${ADMIN_INTERFACE_PORT:-8083}"
    volumes:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/admin-interface:/app/data:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/logs/admin-interface:/app/logs:rw
      - admin-interface-cache:/tmp/admin
    environment:
      - LUCID_ENV=${LUCID_ENV:-production}
      - LUCID_PLATFORM=${LUCID_PLATFORM:-arm64}
      - PROJECT_ROOT=${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}
      - ADMIN_INTERFACE_HOST=${ADMIN_INTERFACE_HOST:-lucid-admin-interface}
      - ADMIN_INTERFACE_PORT=${ADMIN_INTERFACE_PORT:-8083}
      - ADMIN_INTERFACE_URL=${ADMIN_INTERFACE_URL}
      - ADMIN_INTERFACE_DEBUG=${ADMIN_INTERFACE_DEBUG:-false}
      - ADMIN_INTERFACE_LOG_LEVEL=${ADMIN_INTERFACE_LOG_LEVEL:-INFO}
      - ADMIN_INTERFACE_SERVICE_NAME=${ADMIN_INTERFACE_SERVICE_NAME:-lucid-admin-interface}
      - ADMIN_INTERFACE_VERSION=${ADMIN_INTERFACE_VERSION:-1.0.0}
      - MONGODB_URI=${MONGODB_URI:-${MONGODB_URL}}
      - MONGO_URI=${MONGO_URI:-${MONGODB_URI:-${MONGODB_URL}}}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - MONGODB_DATABASE=${MONGODB_DATABASE:-lucid}
      - REDIS_URL=${REDIS_URL}
      - ELASTICSEARCH_URL=${ELASTICSEARCH_URL}
      - AUTH_SERVICE_URL=${AUTH_SERVICE_URL}
      - API_GATEWAY_URL=${API_GATEWAY_URL}
      - BLOCKCHAIN_ENGINE_URL=${BLOCKCHAIN_ENGINE_URL:-${BLOCKCHAIN_URL}}
      - BLOCKCHAIN_URL=${BLOCKCHAIN_URL:-${BLOCKCHAIN_ENGINE_URL}}
      - SESSION_API_URL=${SESSION_API_URL:-${SESSION_MANAGEMENT_URL}}
      - SESSION_MANAGEMENT_URL=${SESSION_MANAGEMENT_URL:-${SESSION_API_URL}}
      - NODE_MANAGEMENT_URL=${NODE_MANAGEMENT_URL}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - JWT_ALGORITHM=${JWT_ALGORITHM:-HS256}
      - CORS_ORIGINS=${CORS_ORIGINS}
      - TRUSTED_HOSTS=${TRUSTED_HOSTS}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test:
        [
          "CMD",
          "/usr/bin/python3.11",
          "-c",
          "import socket; import os; port = int(os.getenv('ADMIN_INTERFACE_PORT', '8083')); s = socket.socket(); s.settimeout(2); result = s.connect_ex(('127.0.0.1', port)); s.close(); exit(0 if result == 0 else 1)",
        ]
      interval: ${HEALTH_CHECK_INTERVAL:-30s}
      timeout: ${HEALTH_CHECK_TIMEOUT:-10s}
      retries: ${HEALTH_CHECK_RETRIES:-3}
      start_period: ${HEALTH_CHECK_START_PERIOD:-40s}
    labels:
      - "lucid.service=admin-interface"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-client:
    image: pickme/lucid-tron-client:latest-arm64
    container_name: tron-client
    restart: unless-stopped
    env_file:
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.foundation
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.support
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.tron-client
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.secrets
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.core
    networks:
      - lucid-tron-isolated
    ports:
      - "8091:8091"
    volumes:
      - /mnt/myssd/Lucid/Lucid/data/tron:/data/tron:rw
      - /mnt/myssd/Lucid/Lucid/data/keys:/data/keys:rw
      - /mnt/myssd/Lucid/Lucid/logs/tron-client:/app/logs:rw
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_CLIENT_HOST=tron-client
      - TRON_CLIENT_PORT=8091
      - TRON_CLIENT_URL=http://tron-client:8091
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8091/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-client"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-payout-router:
    image: pickme/lucid-tron-payout-router:latest-arm64
    container_name: tron-payout-router
    restart: unless-stopped
    env_file:
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.foundation
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.support
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.secrets
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.core
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.application
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.tron-payout-router
    networks:
      - lucid-tron-isolated
    ports:
      - "8092:8092"
    volumes:
      - /mnt/myssd/Lucid/Lucid/data/payments:/data/payouts:rw
      - /mnt/myssd/Lucid/Lucid/data/batches:/data/batches:rw
      - /mnt/myssd/Lucid/Lucid/logs/payout-router:/app/logs:rw
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-payout-router"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-wallet-manager:
    image: pickme/lucid-tron-wallet-manager:latest-arm64
    container_name: tron-wallet-manager
    restart: unless-stopped
    env_file:
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.foundation
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.support
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.secrets
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.core
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.application
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.tron-wallet-manager
    networks:
      - lucid-tron-isolated
    ports:
      - "8093:8093"
    volumes:
      - /mnt/myssd/Lucid/Lucid/data/wallets:/data/wallets:rw
      - /mnt/myssd/Lucid/Lucid/data/keys:/data/keys:ro
      - /mnt/myssd/Lucid/Lucid/logs/wallet-manager:/app/logs:rw
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-wallet-manager"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-usdt-manager:
    image: pickme/lucid-tron-usdt-manager:latest-arm64
    container_name: tron-usdt-manager
    restart: unless-stopped
    env_file:
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.foundation
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.support
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.secrets
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.core
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.application
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.tron-usdt-manager
    networks:
      - lucid-tron-isolated
    ports:
      - "8094:8094"
    volumes:
      - /mnt/myssd/Lucid/Lucid/data/usdt:/data/usdt:rw
      - /mnt/myssd/Lucid/Lucid/data/keys:/data/keys:ro
      - /mnt/myssd/Lucid/Lucid/logs/usdt-manager:/app/logs:rw
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - USDT_CONTRACT_ADDRESS=${USDT_CONTRACT_ADDRESS}
      - USDT_DECIMALS=${USDT_DECIMALS}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-usdt-manager"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-staking:
    image: pickme/lucid-tron-staking:latest-arm64
    container_name: tron-staking
    restart: unless-stopped
    env_file:
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.foundation
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.support
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.secrets
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.core
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.application
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.tron-staking
    networks:
      - lucid-tron-isolated
    ports:
      - "8096:8096"
    volumes:
      - /mnt/myssd/Lucid/Lucid/data/staking:/data/staking:rw
      - /mnt/myssd/Lucid/Lucid/data/keys:/data/keys:ro
      - /mnt/myssd/Lucid/Lucid/logs/trx-staking:/app/logs:rw
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-staking"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-payment-gateway:
    image: pickme/lucid-tron-payment-gateway:latest-arm64
    container_name: tron-payment-gateway
    restart: unless-stopped
    env_file:
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.foundation
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.support
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.secrets
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.core
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.application
      - /mnt/myssd/Lucid/Lucid/configs/environment/.env.tron-payment-gateway
    networks:
      - lucid-tron-isolated
    ports:
      - "8097:8097"
    volumes:
      - /mnt/myssd/Lucid/Lucid/data/gateway:/data/gateway:rw
      - /mnt/myssd/Lucid/Lucid/data/keys:/data/keys:ro
      - /mnt/myssd/Lucid/Lucid/logs/payment-gateway:/app/logs:rw
    environment:
      - LUCID_ENV=production
      - LUCID_PLATFORM=arm64
      - TRON_NETWORK=${TRON_NETWORK}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - USDT_CONTRACT_ADDRESS=${USDT_CONTRACT_ADDRESS}
      - USDT_DECIMALS=${USDT_DECIMALS}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - REDIS_URL=${REDIS_URL}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-payment-gateway"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

volumes:
  admin-interface-cache:
    driver: local
    name: lucid-admin-interface-cache

networks:
  lucid-pi-network:
    external: true
    name: lucid-pi-network
  lucid-tron-isolated:
    external: true
    name: lucid-tron-isolated
