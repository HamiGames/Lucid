name: lucid-support
services:
  # NOTE: admin-interface moved to docker-compose.gui-integration.yml
  # The Electron GUI distroless version is now the canonical admin interface

  lucid-tron-client:
    image: pickme/lucid-tron-client:latest-arm64
    container_name: lucid-tron-client
    hostname: lucid-tron-client
    restart: unless-stopped
    env_file:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.foundation
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.support
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.tron-client
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.secrets
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.core
    networks:
      - lucid-tron-isolated
    ports:
      - "${TRON_CLIENT_PORT:-8091}:${TRON_CLIENT_PORT:-8091}"
      - "8101:8101"
    volumes:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/payment-systems:/data/payment-systems:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/tron:/data/tron:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/keys:/data/keys:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/logs/tron-client:/app/logs:rw
    environment:
      - LUCID_ENV=${LUCID_ENV:-production}
      - LUCID_PLATFORM=${LUCID_PLATFORM:-arm64}
      - PROJECT_ROOT=${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}
      - SERVICE_NAME=lucid-tron-client
      - SERVICE_PORT=${TRON_CLIENT_PORT:-8091}
      - SERVICE_HOST=${TRON_CLIENT_HOST:-0.0.0.0}
      - SERVICE_URL=${TRON_CLIENT_URL:-http://lucid-tron-client:8091}
      - TRON_CLIENT_HOST=lucid-tron-client
      - TRON_CLIENT_PORT=${TRON_CLIENT_PORT:-8091}
      - TRON_CLIENT_URL=${TRON_CLIENT_URL:-http://lucid-tron-client:8091}
      - WORKERS=${WORKERS:-1}
      - TIMEOUT=${TIMEOUT:-30}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DEBUG=${DEBUG:-false}
      - ACCESS_LOG=${ACCESS_LOG:-true}
      - BIND_ADDRESS=${BIND_ADDRESS:-0.0.0.0}
      - TRON_NETWORK=${TRON_NETWORK:-mainnet}
      - TRON_RPC_URL=${TRON_RPC_URL:-https://api.trongrid.io}
      - TRON_RPC_URL_MAINNET=${TRON_RPC_URL_MAINNET:-https://api.trongrid.io}
      - TRON_RPC_URL_SHASTA=${TRON_RPC_URL_SHASTA:-https://api.shasta.trongrid.io}
      - TRON_HTTP_ENDPOINT=${TRON_HTTP_ENDPOINT}
      - TRONGRID_API_KEY=${TRONGRID_API_KEY}
      - TRON_API_KEY=${TRON_API_KEY}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - TRON_TIMEOUT=${TRON_TIMEOUT:-30}
      - USDT_CONTRACT_ADDRESS=${USDT_CONTRACT_ADDRESS:-TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t}
      - DATA_DIRECTORY=${DATA_DIRECTORY:-/data/payment-systems}
      - TRON_DATA_DIR=${TRON_DATA_DIR:-/data/payment-systems/tron-client}
      - LOG_FILE=${LOG_FILE:-/app/logs/tron-client.log}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - MONGODB_URI=${MONGODB_URI:-${MONGODB_URL}}
      - MONGODB_DATABASE=${MONGODB_DATABASE:-lucid_payments}
      - REDIS_URL=${REDIS_URL:-redis://lucid-redis:6379}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_DATABASE=${REDIS_DATABASE:-0}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - WALLET_ENCRYPTION_KEY=${WALLET_ENCRYPTION_KEY}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - API_GATEWAY_URL=${API_GATEWAY_URL:-http://lucid-api-gateway:8080}
      - CORS_ORIGINS=${CORS_ORIGINS:-*}
      - CORS_METHODS=${CORS_METHODS:-GET,POST,PUT,DELETE,OPTIONS}
      - CORS_HEADERS=${CORS_HEADERS:-*}
      - CORS_ALLOW_CREDENTIALS=${CORS_ALLOW_CREDENTIALS:-true}
      - TRUSTED_HOSTS=${TRUSTED_HOSTS:-*}
      - RATE_LIMIT_ENABLED=${RATE_LIMIT_ENABLED:-true}
      - RATE_LIMIT_REQUESTS=${RATE_LIMIT_REQUESTS:-100}
      - RATE_LIMIT_WINDOW=${RATE_LIMIT_WINDOW:-60}
      - METRICS_ENABLED=${METRICS_ENABLED:-true}
      - HEALTH_CHECK_INTERVAL=${HEALTH_CHECK_INTERVAL:-60}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test:
        [
          "CMD",
          "/usr/bin/python3.11",
          "-c",
          "import os, urllib.request, sys; port = os.getenv('TRON_CLIENT_PORT', '8091'); url = 'http://127.0.0.1:' + str(port) + '/health'; urllib.request.urlopen(url, timeout=10).read(); sys.exit(0)",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-client"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-payout-router:
    image: pickme/lucid-tron-payout-router:latest-arm64
    container_name: tron-payout-router
    hostname: tron-payout-router
    restart: unless-stopped
    env_file:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.foundation
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.support
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.tron-payout-router
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.secrets
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.core
    networks:
      - lucid-tron-isolated
    ports:
      - "${PAYOUT_ROUTER_PORT:-8092}:${PAYOUT_ROUTER_PORT:-8092}"
    volumes:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/payment-systems:/data/payment-systems:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/payments:/data/payouts:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/batches:/data/batches:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/keys:/data/keys:ro
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/logs/payout-router:/app/logs:rw
    environment:
      - LUCID_ENV=${LUCID_ENV:-production}
      - LUCID_PLATFORM=${LUCID_PLATFORM:-arm64}
      - PROJECT_ROOT=${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}
      - SERVICE_NAME=tron-payout-router
      - SERVICE_PORT=${PAYOUT_ROUTER_PORT:-8092}
      - SERVICE_HOST=${PAYOUT_ROUTER_HOST:-0.0.0.0}
      - SERVICE_URL=${PAYOUT_ROUTER_URL:-http://tron-payout-router:8092}
      - PAYOUT_ROUTER_HOST=tron-payout-router
      - PAYOUT_ROUTER_PORT=${PAYOUT_ROUTER_PORT:-8092}
      - PAYOUT_ROUTER_URL=${PAYOUT_ROUTER_URL:-http://tron-payout-router:8092}
      - TRON_CLIENT_URL=${TRON_CLIENT_URL:-http://lucid-tron-client:8091}
      - TRON_NETWORK=${TRON_NETWORK:-mainnet}
      - TRON_RPC_URL=${TRON_RPC_URL:-https://api.trongrid.io}
      - TRON_RPC_URL_MAINNET=${TRON_RPC_URL_MAINNET:-https://api.trongrid.io}
      - TRON_RPC_URL_SHASTA=${TRON_RPC_URL_SHASTA:-https://api.shasta.trongrid.io}
      - TRON_HTTP_ENDPOINT=${TRON_HTTP_ENDPOINT}
      - TRONGRID_API_KEY=${TRONGRID_API_KEY}
      - TRON_API_KEY=${TRON_API_KEY}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - TRON_TIMEOUT=${TRON_TIMEOUT:-30}
      - USDT_CONTRACT_ADDRESS=${USDT_CONTRACT_ADDRESS:-TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t}
      - DATA_DIRECTORY=${DATA_DIRECTORY:-/data/payment-systems}
      - TRON_DATA_DIR=${TRON_DATA_DIR:-/data/payment-systems/payout-router}
      - LOG_FILE=${LOG_FILE:-/app/logs/payout-router.log}
      - PAYOUT_BATCH_SIZE=${PAYOUT_BATCH_SIZE:-50}
      - PAYOUT_BATCH_INTERVAL=${PAYOUT_BATCH_INTERVAL:-300}
      - MAX_PAYOUT_AMOUNT=${MAX_PAYOUT_AMOUNT:-1000.0}
      - MIN_PAYOUT_AMOUNT=${MIN_PAYOUT_AMOUNT:-0.01}
      - DAILY_PAYOUT_LIMIT=${DAILY_PAYOUT_LIMIT:-10000.0}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - MONGODB_URI=${MONGODB_URI:-${MONGODB_URL}}
      - MONGODB_DATABASE=${MONGODB_DATABASE:-lucid_payments}
      - REDIS_URL=${REDIS_URL:-redis://lucid-redis:6379}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_DATABASE=${REDIS_DATABASE:-0}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - WALLET_ENCRYPTION_KEY=${WALLET_ENCRYPTION_KEY}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - API_GATEWAY_URL=${API_GATEWAY_URL:-http://lucid-api-gateway:8080}
      - CORS_ORIGINS=${CORS_ORIGINS:-*}
      - CORS_METHODS=${CORS_METHODS:-GET,POST,PUT,DELETE,OPTIONS}
      - CORS_HEADERS=${CORS_HEADERS:-*}
      - CORS_ALLOW_CREDENTIALS=${CORS_ALLOW_CREDENTIALS:-true}
      - TRUSTED_HOSTS=${TRUSTED_HOSTS:-*}
      - RATE_LIMIT_ENABLED=${RATE_LIMIT_ENABLED:-true}
      - RATE_LIMIT_REQUESTS=${RATE_LIMIT_REQUESTS:-100}
      - RATE_LIMIT_WINDOW=${RATE_LIMIT_WINDOW:-60}
      - METRICS_ENABLED=${METRICS_ENABLED:-true}
      - HEALTH_CHECK_INTERVAL=${HEALTH_CHECK_INTERVAL:-60}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DEBUG=${DEBUG:-false}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test:
        [
          "CMD",
          "/opt/venv/bin/python3",
          "-c",
          "import os; import urllib.request; port = os.getenv('SERVICE_PORT', '8092'); urllib.request.urlopen(f'http://localhost:{port}/health').read(); exit(0)",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-payout-router"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      lucid-mongodb:
        condition: service_started
      lucid-redis:
        condition: service_started

  tron-wallet-manager:
    image: pickme/lucid-tron-wallet-manager:latest-arm64
    container_name: tron-wallet-manager
    hostname: tron-wallet-manager
    restart: unless-stopped
    env_file:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.foundation
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.support
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.tron-wallet-manager
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.secrets
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.core
    networks:
      - lucid-tron-isolated
    ports:
      - "${WALLET_MANAGER_PORT:-8093}:${WALLET_MANAGER_PORT:-8093}"
    volumes:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/payment-systems:/data/payment-systems:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/wallets:/data/wallets:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/keys:/data/keys:ro
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/logs/wallet-manager:/app/logs:rw
    environment:
      - LUCID_ENV=${LUCID_ENV:-production}
      - LUCID_PLATFORM=${LUCID_PLATFORM:-arm64}
      - PROJECT_ROOT=${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}
      - SERVICE_NAME=tron-wallet-manager
      - SERVICE_PORT=${WALLET_MANAGER_PORT:-8093}
      - SERVICE_HOST=${WALLET_MANAGER_HOST:-0.0.0.0}
      - SERVICE_URL=${WALLET_MANAGER_URL:-http://tron-wallet-manager:8093}
      - WALLET_MANAGER_HOST=tron-wallet-manager
      - WALLET_MANAGER_PORT=${WALLET_MANAGER_PORT:-8093}
      - WALLET_MANAGER_URL=${WALLET_MANAGER_URL:-http://tron-wallet-manager:8093}
      - TRON_CLIENT_URL=${TRON_CLIENT_URL:-http://lucid-tron-client:8091}
      - TRON_NETWORK=${TRON_NETWORK:-mainnet}
      - TRON_RPC_URL=${TRON_RPC_URL:-https://api.trongrid.io}
      - TRON_RPC_URL_MAINNET=${TRON_RPC_URL_MAINNET:-https://api.trongrid.io}
      - TRON_RPC_URL_SHASTA=${TRON_RPC_URL_SHASTA:-https://api.shasta.trongrid.io}
      - TRON_HTTP_ENDPOINT=${TRON_HTTP_ENDPOINT}
      - TRONGRID_API_KEY=${TRONGRID_API_KEY}
      - TRON_API_KEY=${TRON_API_KEY}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - TRON_TIMEOUT=${TRON_TIMEOUT:-30}
      - DATA_DIRECTORY=${DATA_DIRECTORY:-/data/payment-systems}
      - TRON_DATA_DIR=${TRON_DATA_DIR:-/data/payment-systems/wallet-manager}
      - LOG_FILE=${LOG_FILE:-/app/logs/wallet-manager.log}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - MONGODB_URI=${MONGODB_URI:-${MONGODB_URL}}
      - MONGODB_DATABASE=${MONGODB_DATABASE:-lucid_payments}
      - REDIS_URL=${REDIS_URL:-redis://lucid-redis:6379}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_DATABASE=${REDIS_DATABASE:-0}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - WALLET_ENCRYPTION_KEY=${WALLET_ENCRYPTION_KEY:-}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - API_GATEWAY_URL=${API_GATEWAY_URL:-http://lucid-api-gateway:8080}
      - CORS_ORIGINS=${CORS_ORIGINS:-*}
      - CORS_METHODS=${CORS_METHODS:-GET,POST,PUT,DELETE,OPTIONS}
      - CORS_HEADERS=${CORS_HEADERS:-*}
      - CORS_ALLOW_CREDENTIALS=${CORS_ALLOW_CREDENTIALS:-true}
      - TRUSTED_HOSTS=${TRUSTED_HOSTS:-*}
      - RATE_LIMIT_ENABLED=${RATE_LIMIT_ENABLED:-true}
      - RATE_LIMIT_REQUESTS=${RATE_LIMIT_REQUESTS:-100}
      - RATE_LIMIT_WINDOW=${RATE_LIMIT_WINDOW:-60}
      - METRICS_ENABLED=${METRICS_ENABLED:-true}
      - HEALTH_CHECK_INTERVAL=${HEALTH_CHECK_INTERVAL:-60}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DEBUG=${DEBUG:-false}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test:
        [
          "CMD",
          "/usr/bin/python3.11",
          "-c",
          "import os, urllib.request, sys; port = os.getenv('WALLET_MANAGER_PORT', '8093'); url = 'http://127.0.0.1:' + str(port) + '/health'; urllib.request.urlopen(url, timeout=10).read(); sys.exit(0)",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-wallet-manager"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-usdt-manager:
    image: pickme/lucid-tron-usdt-manager:latest-arm64
    container_name: tron-usdt-manager
    hostname: tron-usdt-manager
    restart: unless-stopped
    env_file:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.foundation
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.support
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.tron-usdt-manager
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.secrets
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.core
    networks:
      - lucid-tron-isolated
    ports:
      - "${USDT_MANAGER_PORT:-8094}:${USDT_MANAGER_PORT:-8094}"
    volumes:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/payment-systems:/data/payment-systems:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/usdt:/data/usdt:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/keys:/data/keys:ro
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/logs/usdt-manager:/app/logs:rw
    environment:
      - LUCID_ENV=${LUCID_ENV:-production}
      - LUCID_PLATFORM=${LUCID_PLATFORM:-arm64}
      - PROJECT_ROOT=${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}
      - SERVICE_NAME=tron-usdt-manager
      - SERVICE_PORT=${USDT_MANAGER_PORT:-8094}
      - SERVICE_HOST=${USDT_MANAGER_HOST:-0.0.0.0}
      - SERVICE_URL=${USDT_MANAGER_URL:-http://tron-usdt-manager:8094}
      - USDT_MANAGER_HOST=tron-usdt-manager
      - USDT_MANAGER_PORT=${USDT_MANAGER_PORT:-8094}
      - USDT_MANAGER_URL=${USDT_MANAGER_URL:-http://tron-usdt-manager:8094}
      - TRON_CLIENT_URL=${TRON_CLIENT_URL:-http://lucid-tron-client:8091}
      - WALLET_MANAGER_URL=${WALLET_MANAGER_URL:-http://tron-wallet-manager:8093}
      - TRON_NETWORK=${TRON_NETWORK:-mainnet}
      - TRON_RPC_URL=${TRON_RPC_URL:-https://api.trongrid.io}
      - TRON_RPC_URL_MAINNET=${TRON_RPC_URL_MAINNET:-https://api.trongrid.io}
      - TRON_RPC_URL_SHASTA=${TRON_RPC_URL_SHASTA:-https://api.shasta.trongrid.io}
      - TRON_HTTP_ENDPOINT=${TRON_HTTP_ENDPOINT}
      - TRONGRID_API_KEY=${TRONGRID_API_KEY}
      - TRON_API_KEY=${TRON_API_KEY}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - TRON_TIMEOUT=${TRON_TIMEOUT:-30}
      - USDT_CONTRACT_ADDRESS=${USDT_CONTRACT_ADDRESS:-TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t}
      - USDT_CONTRACT_ADDRESS_MAINNET=${USDT_CONTRACT_ADDRESS_MAINNET:-${USDT_CONTRACT_ADDRESS:-TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t}}
      - USDT_CONTRACT_ADDRESS_SHASTA=${USDT_CONTRACT_ADDRESS_SHASTA:-TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs}
      - USDT_DECIMALS=${USDT_DECIMALS:-6}
      - DATA_DIRECTORY=${DATA_DIRECTORY:-/data/payment-systems}
      - TRON_DATA_DIR=${TRON_DATA_DIR:-/data/payment-systems/usdt-manager}
      - LOG_FILE=${LOG_FILE:-/app/logs/usdt-manager.log}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - MONGODB_URI=${MONGODB_URI:-${MONGODB_URL}}
      - MONGODB_DATABASE=${MONGODB_DATABASE:-lucid_payments}
      - REDIS_URL=${REDIS_URL:-redis://lucid-redis:6379}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_DATABASE=${REDIS_DATABASE:-0}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - WALLET_ENCRYPTION_KEY=${WALLET_ENCRYPTION_KEY}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - API_GATEWAY_URL=${API_GATEWAY_URL:-http://lucid-api-gateway:8080}
      - CORS_ORIGINS=${CORS_ORIGINS:-*}
      - CORS_METHODS=${CORS_METHODS:-GET,POST,PUT,DELETE,OPTIONS}
      - CORS_HEADERS=${CORS_HEADERS:-*}
      - CORS_ALLOW_CREDENTIALS=${CORS_ALLOW_CREDENTIALS:-true}
      - TRUSTED_HOSTS=${TRUSTED_HOSTS:-*}
      - RATE_LIMIT_ENABLED=${RATE_LIMIT_ENABLED:-true}
      - RATE_LIMIT_REQUESTS=${RATE_LIMIT_REQUESTS:-100}
      - RATE_LIMIT_WINDOW=${RATE_LIMIT_WINDOW:-60}
      - METRICS_ENABLED=${METRICS_ENABLED:-true}
      - HEALTH_CHECK_INTERVAL=${HEALTH_CHECK_INTERVAL:-60}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DEBUG=${DEBUG:-false}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test:
        [
          "CMD",
          "/usr/bin/python3.11",
          "-c",
          "import os, urllib.request, sys; port = os.getenv('USDT_MANAGER_PORT', '8094'); url = 'http://127.0.0.1:' + str(port) + '/health'; urllib.request.urlopen(url, timeout=10).read(); sys.exit(0)",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-usdt-manager"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-staking:
    image: pickme/lucid-tron-staking:latest-arm64
    container_name: tron-staking
    hostname: tron-staking
    restart: unless-stopped
    env_file:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.foundation
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.support
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.tron-staking
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.secrets
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.core
    networks:
      - lucid-tron-isolated
    ports:
      - "${STAKING_PORT:-8096}:${STAKING_PORT:-8096}"
    volumes:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/payment-systems:/data/payment-systems:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/staking:/data/staking:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/keys:/data/keys:ro
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/logs/trx-staking:/app/logs:rw
    environment:
      - LUCID_ENV=${LUCID_ENV:-production}
      - LUCID_PLATFORM=${LUCID_PLATFORM:-arm64}
      - PROJECT_ROOT=${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}
      - SERVICE_NAME=tron-staking
      - SERVICE_PORT=${STAKING_PORT:-8096}
      - SERVICE_HOST=${STAKING_HOST:-0.0.0.0}
      - SERVICE_URL=${STAKING_URL:-http://tron-staking:8096}
      - STAKING_HOST=tron-staking
      - STAKING_PORT=${STAKING_PORT:-8096}
      - STAKING_URL=${STAKING_URL:-http://tron-staking:8096}
      - TRON_CLIENT_URL=${TRON_CLIENT_URL:-http://lucid-tron-client:8091}
      - WALLET_MANAGER_URL=${WALLET_MANAGER_URL:-http://tron-wallet-manager:8093}
      - TRON_NETWORK=${TRON_NETWORK:-mainnet}
      - TRON_RPC_URL=${TRON_RPC_URL:-https://api.trongrid.io}
      - TRON_RPC_URL_MAINNET=${TRON_RPC_URL_MAINNET:-https://api.trongrid.io}
      - TRON_RPC_URL_SHASTA=${TRON_RPC_URL_SHASTA:-https://api.shasta.trongrid.io}
      - TRON_HTTP_ENDPOINT=${TRON_HTTP_ENDPOINT}
      - TRONGRID_API_KEY=${TRONGRID_API_KEY}
      - TRON_API_KEY=${TRON_API_KEY}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - TRON_TIMEOUT=${TRON_TIMEOUT:-30}
      - DATA_DIRECTORY=${DATA_DIRECTORY:-/data/payment-systems}
      - TRON_DATA_DIR=${TRON_DATA_DIR:-/data/payment-systems/trx-staking}
      - LOG_FILE=${LOG_FILE:-/app/logs/trx-staking.log}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - MONGODB_URI=${MONGODB_URI:-${MONGODB_URL}}
      - MONGODB_DATABASE=${MONGODB_DATABASE:-lucid_payments}
      - REDIS_URL=${REDIS_URL:-redis://lucid-redis:6379}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_DATABASE=${REDIS_DATABASE:-0}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - WALLET_ENCRYPTION_KEY=${WALLET_ENCRYPTION_KEY}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - API_GATEWAY_URL=${API_GATEWAY_URL:-http://lucid-api-gateway:8080}
      - CORS_ORIGINS=${CORS_ORIGINS:-*}
      - CORS_METHODS=${CORS_METHODS:-GET,POST,PUT,DELETE,OPTIONS}
      - CORS_HEADERS=${CORS_HEADERS:-*}
      - CORS_ALLOW_CREDENTIALS=${CORS_ALLOW_CREDENTIALS:-true}
      - TRUSTED_HOSTS=${TRUSTED_HOSTS:-*}
      - RATE_LIMIT_ENABLED=${RATE_LIMIT_ENABLED:-true}
      - RATE_LIMIT_REQUESTS=${RATE_LIMIT_REQUESTS:-100}
      - RATE_LIMIT_WINDOW=${RATE_LIMIT_WINDOW:-60}
      - METRICS_ENABLED=${METRICS_ENABLED:-true}
      - HEALTH_CHECK_INTERVAL=${HEALTH_CHECK_INTERVAL:-60}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DEBUG=${DEBUG:-false}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test:
        [
          "CMD",
          "/opt/venv/bin/python3",
          "-c",
          "import os; import urllib.request; port = os.getenv('STAKING_PORT', '8096'); urllib.request.urlopen(f'http://127.0.0.1:{port}/health').read(); exit(0)",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-staking"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      tor-proxy:
        condition: service_started

  tron-payment-gateway:
    image: pickme/lucid-tron-payment-gateway:latest-arm64
    container_name: tron-payment-gateway
    hostname: tron-payment-gateway
    restart: unless-stopped
    env_file:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.foundation
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.support
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.tron-payment-gateway
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.secrets
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/configs/environment/.env.core
    networks:
      - lucid-tron-isolated
    ports:
      - "${PAYMENT_GATEWAY_PORT:-8097}:${PAYMENT_GATEWAY_PORT:-8097}"
    volumes:
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/payment-systems:/data/payment-systems:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/gateway:/data/gateway:rw
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/data/keys:/data/keys:ro
      - ${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}/logs/payment-gateway:/app/logs:rw
    environment:
      - LUCID_ENV=${LUCID_ENV:-production}
      - LUCID_PLATFORM=${LUCID_PLATFORM:-arm64}
      - PROJECT_ROOT=${PROJECT_ROOT:-/mnt/myssd/Lucid/Lucid}
      - SERVICE_NAME=tron-payment-gateway
      - SERVICE_PORT=${PAYMENT_GATEWAY_PORT:-8097}
      - SERVICE_HOST=${PAYMENT_GATEWAY_HOST:-0.0.0.0}
      - SERVICE_URL=${PAYMENT_GATEWAY_URL:-http://tron-payment-gateway:8097}
      - PAYMENT_GATEWAY_HOST=tron-payment-gateway
      - PAYMENT_GATEWAY_PORT=${PAYMENT_GATEWAY_PORT:-8097}
      - PAYMENT_GATEWAY_URL=${PAYMENT_GATEWAY_URL:-http://tron-payment-gateway:8097}
      - TRON_CLIENT_URL=${TRON_CLIENT_URL:-http://lucid-tron-client:8091}
      - PAYOUT_ROUTER_URL=${PAYOUT_ROUTER_URL:-http://tron-payout-router:8092}
      - WALLET_MANAGER_URL=${WALLET_MANAGER_URL:-http://tron-wallet-manager:8093}
      - USDT_MANAGER_URL=${USDT_MANAGER_URL:-http://tron-usdt-manager:8094}
      - TRON_NETWORK=${TRON_NETWORK:-mainnet}
      - TRON_RPC_URL=${TRON_RPC_URL:-https://api.trongrid.io}
      - TRON_RPC_URL_MAINNET=${TRON_RPC_URL_MAINNET:-https://api.trongrid.io}
      - TRON_RPC_URL_SHASTA=${TRON_RPC_URL_SHASTA:-https://api.shasta.trongrid.io}
      - TRON_HTTP_ENDPOINT=${TRON_HTTP_ENDPOINT}
      - TRONGRID_API_KEY=${TRONGRID_API_KEY}
      - TRON_API_KEY=${TRON_API_KEY}
      - TRON_NODE_URL=${TRON_NODE_URL}
      - TRON_PRIVATE_KEY=${TRON_PRIVATE_KEY}
      - TRON_ADDRESS=${TRON_ADDRESS}
      - TRON_TIMEOUT=${TRON_TIMEOUT:-30}
      - USDT_CONTRACT_ADDRESS=${USDT_CONTRACT_ADDRESS:-TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t}
      - USDT_CONTRACT_ADDRESS_MAINNET=${USDT_CONTRACT_ADDRESS_MAINNET:-${USDT_CONTRACT_ADDRESS:-TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t}}
      - USDT_CONTRACT_ADDRESS_SHASTA=${USDT_CONTRACT_ADDRESS_SHASTA:-TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs}
      - USDT_DECIMALS=${USDT_DECIMALS:-6}
      - DATA_DIRECTORY=${DATA_DIRECTORY:-/data/payment-systems}
      - TRON_DATA_DIR=${TRON_DATA_DIR:-/data/payment-systems/payment-gateway}
      - LOG_FILE=${LOG_FILE:-/app/logs/payment-gateway.log}
      - MONGODB_URL=${MONGODB_URL:?MONGODB_URL not set}
      - MONGODB_URI=${MONGODB_URI:-${MONGODB_URL}}
      - MONGODB_DATABASE=${MONGODB_DATABASE:-lucid_payments}
      - REDIS_URL=${REDIS_URL:-redis://lucid-redis:6379}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_DATABASE=${REDIS_DATABASE:-0}
      - JWT_SECRET_KEY=${JWT_SECRET_KEY}
      - WALLET_ENCRYPTION_KEY=${WALLET_ENCRYPTION_KEY}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - API_GATEWAY_URL=${API_GATEWAY_URL:-http://lucid-api-gateway:8080}
      - CORS_ORIGINS=${CORS_ORIGINS:-*}
      - CORS_METHODS=${CORS_METHODS:-GET,POST,PUT,DELETE,OPTIONS}
      - CORS_HEADERS=${CORS_HEADERS:-*}
      - CORS_ALLOW_CREDENTIALS=${CORS_ALLOW_CREDENTIALS:-true}
      - TRUSTED_HOSTS=${TRUSTED_HOSTS:-*}
      - RATE_LIMIT_ENABLED=${RATE_LIMIT_ENABLED:-true}
      - RATE_LIMIT_REQUESTS=${RATE_LIMIT_REQUESTS:-100}
      - RATE_LIMIT_WINDOW=${RATE_LIMIT_WINDOW:-60}
      - METRICS_ENABLED=${METRICS_ENABLED:-true}
      - HEALTH_CHECK_INTERVAL=${HEALTH_CHECK_INTERVAL:-60}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DEBUG=${DEBUG:-false}
    user: "65532:65532"
    security_opt:
      - no-new-privileges:true
      - seccomp:unconfined
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
    healthcheck:
      test:
        [
          "CMD",
          "/opt/venv/bin/python3",
          "-c",
          "import os; import urllib.request; port = os.getenv('PAYMENT_GATEWAY_PORT', '8097'); urllib.request.urlopen(f'http://127.0.0.1:{port}/health').read(); exit(0)",
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "lucid.service=tron-payment-gateway"
      - "lucid.type=distroless"
      - "lucid.platform=arm64"
      - "lucid.security=hardened"
      - "lucid.cluster=support"
      - "lucid.network=tron-isolated"
    depends_on:
      lucid-mongodb:
        condition: service_started
      lucid-redis:
        condition: service_started
      lucid-tron-client:
        condition: service_started
      tron-payout-router:
        condition: service_started
      tron-wallet-manager:
        condition: service_started
      tron-usdt-manager:
        condition: service_started

volumes:
  # Payment Systems & TRON Services
  # ================================
  # Data volumes
  payment-systems-data:
    driver: local
    name: lucid-payment-systems-data

  tron-data:
    driver: local
    name: lucid-tron-data

  wallets-data:
    driver: local
    name: lucid-wallets-data

  usdt-data:
    driver: local
    name: lucid-usdt-data

  gateway-data:
    driver: local
    name: lucid-gateway-data

  keys-data:
    driver: local
    name: lucid-keys-data

  batches-data:
    driver: local
    name: lucid-batches-data

  payouts-data:
    driver: local
    name: lucid-payouts-data

  # Log volumes
  tron-client-logs:
    driver: local
    name: lucid-tron-client-logs

  payout-router-logs:
    driver: local
    name: lucid-payout-router-logs

  wallet-manager-logs:
    driver: local
    name: lucid-wallet-manager-logs

  usdt-manager-logs:
    driver: local
    name: lucid-usdt-manager-logs

  payment-gateway-logs:
    driver: local
    name: lucid-payment-gateway-logs

  # Tor volumes
  tor-data:
    driver: local
    name: lucid-tor-data

  tor-logs:
    driver: local
    name: lucid-tor-logs

networks:
  lucid-pi-network:
    external: true
    name: lucid-pi-network
  lucid-tron-isolated:
    external: true
    name: lucid-tron-isolated
