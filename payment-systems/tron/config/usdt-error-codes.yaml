# Lucid TRON USDT Manager - Error Codes Configuration
# File: payment-systems/tron/config/usdt-error-codes.yaml
# Purpose: Define USDT manager specific error codes, recovery actions, and retry policies

# USDT Manager Error Codes
error_codes:
  # Success codes
  USDT_001:
    code: USDT_001
    message: "Token registered successfully"
    severity: "info"
    http_status: 201
    recovery: "none"
    retry_policy: "none"
  
  USDT_002:
    code: USDT_002
    message: "Balance retrieved successfully"
    severity: "info"
    http_status: 200
    recovery: "none"
    retry_policy: "none"
  
  USDT_003:
    code: USDT_003
    message: "Transfer initiated successfully"
    severity: "info"
    http_status: 202
    recovery: "none"
    retry_policy: "none"
  
  USDT_004:
    code: USDT_004
    message: "Allowance retrieved successfully"
    severity: "info"
    http_status: 200
    recovery: "none"
    retry_policy: "none"
  
  USDT_005:
    code: USDT_005
    message: "Approval submitted successfully"
    severity: "info"
    http_status: 202
    recovery: "none"
    retry_policy: "none"

  # Validation Errors
  USDT_ERR_100:
    code: USDT_ERR_100
    message: "Invalid TRON address format"
    severity: "error"
    http_status: 400
    recovery: "validate_address"
    retry_policy: "no_retry"
  
  USDT_ERR_101:
    code: USDT_ERR_101
    message: "Invalid contract address"
    severity: "error"
    http_status: 400
    recovery: "validate_contract"
    retry_policy: "no_retry"
  
  USDT_ERR_102:
    code: USDT_ERR_102
    message: "Invalid transfer amount"
    severity: "error"
    http_status: 400
    recovery: "validate_amount"
    retry_policy: "no_retry"
  
  USDT_ERR_103:
    code: USDT_ERR_103
    message: "Insufficient balance"
    severity: "error"
    http_status: 402
    recovery: "check_balance"
    retry_policy: "no_retry"
  
  USDT_ERR_104:
    code: USDT_ERR_104
    message: "Invalid transaction ID"
    severity: "error"
    http_status: 400
    recovery: "validate_txid"
    retry_policy: "no_retry"
  
  USDT_ERR_105:
    code: USDT_ERR_105
    message: "Token not found"
    severity: "error"
    http_status: 404
    recovery: "register_token"
    retry_policy: "no_retry"
  
  USDT_ERR_106:
    code: USDT_ERR_106
    message: "Invalid decimal places"
    severity: "error"
    http_status: 400
    recovery: "validate_decimals"
    retry_policy: "no_retry"

  # Transfer Errors
  USDT_ERR_200:
    code: USDT_ERR_200
    message: "Transfer failed on blockchain"
    severity: "error"
    http_status: 500
    recovery: "retry_transfer"
    retry_policy: "exponential_backoff"
    max_retries: 3
    retry_delay: 5
  
  USDT_ERR_201:
    code: USDT_ERR_201
    message: "Transaction pending confirmation"
    severity: "warning"
    http_status: 202
    recovery: "wait_confirmation"
    retry_policy: "linear"
    max_retries: 12
    retry_delay: 5
  
  USDT_ERR_202:
    code: USDT_ERR_202
    message: "Insufficient energy for transaction"
    severity: "error"
    http_status: 402
    recovery: "acquire_energy"
    retry_policy: "exponential_backoff"
    max_retries: 3
  
  USDT_ERR_203:
    code: USDT_ERR_203
    message: "Nonce conflict"
    severity: "error"
    http_status: 409
    recovery: "update_nonce"
    retry_policy: "exponential_backoff"
    max_retries: 3

  # Contract Interaction Errors
  USDT_ERR_300:
    code: USDT_ERR_300
    message: "Contract call failed"
    severity: "error"
    http_status: 500
    recovery: "retry_contract_call"
    retry_policy: "exponential_backoff"
    max_retries: 3
  
  USDT_ERR_301:
    code: USDT_ERR_301
    message: "ABI encoding error"
    severity: "error"
    http_status: 400
    recovery: "validate_parameters"
    retry_policy: "no_retry"
  
  USDT_ERR_302:
    code: USDT_ERR_302
    message: "Contract execution reverted"
    severity: "error"
    http_status: 400
    recovery: "check_contract_state"
    retry_policy: "no_retry"
  
  USDT_ERR_303:
    code: USDT_ERR_303
    message: "Out of gas"
    severity: "error"
    http_status: 402
    recovery: "increase_gas"
    retry_policy: "exponential_backoff"
    max_retries: 2

  # TRON Network Errors
  USDT_ERR_400:
    code: USDT_ERR_400
    message: "TRON network unavailable"
    severity: "error"
    http_status: 503
    recovery: "wait_network"
    retry_policy: "exponential_backoff"
    max_retries: 5
    retry_delay: 10
  
  USDT_ERR_401:
    code: USDT_ERR_401
    message: "RPC endpoint error"
    severity: "error"
    http_status: 502
    recovery: "try_fallback_endpoint"
    retry_policy: "exponential_backoff"
    max_retries: 3
  
  USDT_ERR_402:
    code: USDT_ERR_402
    message: "Block confirmation timeout"
    severity: "error"
    http_status: 504
    recovery: "retry_confirmation_check"
    retry_policy: "linear"
    max_retries: 6
    retry_delay: 10

  # Signature & Security Errors
  USDT_ERR_500:
    code: USDT_ERR_500
    message: "Invalid private key"
    severity: "critical"
    http_status: 400
    recovery: "provide_valid_key"
    retry_policy: "no_retry"
  
  USDT_ERR_501:
    code: USDT_ERR_501
    message: "Signature verification failed"
    severity: "critical"
    http_status: 401
    recovery: "resign_transaction"
    retry_policy: "no_retry"
  
  USDT_ERR_502:
    code: USDT_ERR_502
    message: "Transaction rejected by security policy"
    severity: "critical"
    http_status: 403
    recovery: "review_transaction"
    retry_policy: "no_retry"
  
  USDT_ERR_503:
    code: USDT_ERR_503
    message: "Insufficient permissions"
    severity: "critical"
    http_status: 403
    recovery: "grant_permissions"
    retry_policy: "no_retry"

  # Database/Storage Errors
  USDT_ERR_600:
    code: USDT_ERR_600
    message: "Database connection failed"
    severity: "error"
    http_status: 503
    recovery: "reconnect_database"
    retry_policy: "exponential_backoff"
    max_retries: 5
    retry_delay: 2
  
  USDT_ERR_601:
    code: USDT_ERR_601
    message: "Data persistence failed"
    severity: "error"
    http_status: 500
    recovery: "retry_persistence"
    retry_policy: "exponential_backoff"
    max_retries: 3
  
  USDT_ERR_602:
    code: USDT_ERR_602
    message: "Data corruption detected"
    severity: "critical"
    http_status: 500
    recovery: "restore_from_backup"
    retry_policy: "no_retry"

  # Rate Limiting & Compliance
  USDT_ERR_700:
    code: USDT_ERR_700
    message: "Rate limit exceeded"
    severity: "warning"
    http_status: 429
    recovery: "retry_after_delay"
    retry_policy: "linear"
    max_retries: 1
    retry_delay: 60
  
  USDT_ERR_701:
    code: USDT_ERR_701
    message: "AML/KYC check required"
    severity: "warning"
    http_status: 202
    recovery: "perform_kyc_check"
    retry_policy: "no_retry"
  
  USDT_ERR_702:
    code: USDT_ERR_702
    message: "Transaction limit exceeded"
    severity: "warning"
    http_status: 402
    recovery: "wait_period"
    retry_policy: "no_retry"
  
  USDT_ERR_703:
    code: USDT_ERR_703
    message: "Daily transfer limit reached"
    severity: "warning"
    http_status: 402
    recovery: "wait_next_period"
    retry_policy: "no_retry"

  # Internal Server Errors
  USDT_ERR_800:
    code: USDT_ERR_800
    message: "Internal server error"
    severity: "critical"
    http_status: 500
    recovery: "log_and_alert"
    retry_policy: "exponential_backoff"
    max_retries: 1
    retry_delay: 5
  
  USDT_ERR_801:
    code: USDT_ERR_801
    message: "Service unavailable"
    severity: "critical"
    http_status: 503
    recovery: "wait_service_recovery"
    retry_policy: "exponential_backoff"
    max_retries: 5
    retry_delay: 10
  
  USDT_ERR_802:
    code: USDT_ERR_802
    message: "Configuration error"
    severity: "critical"
    http_status: 500
    recovery: "fix_configuration"
    retry_policy: "no_retry"

# Retry Policies
retry_policies:
  no_retry:
    max_attempts: 1
    description: "No retry - fail immediately"
  
  linear:
    max_attempts: 3
    strategy: "linear"
    base_delay: 1
    max_delay: 60
    description: "Linear backoff retry"
  
  exponential_backoff:
    max_attempts: 5
    strategy: "exponential"
    base_delay: 1
    multiplier: 2
    max_delay: 300
    jitter: true
    description: "Exponential backoff with jitter"

# Recovery Actions
recovery_actions:
  none:
    description: "No recovery action needed"
    steps: []
  
  validate_address:
    description: "Validate TRON address format"
    steps:
      - "Check address starts with 'T'"
      - "Verify address length is 34 characters"
      - "Validate checksum"
  
  validate_contract:
    description: "Validate contract address"
    steps:
      - "Verify contract exists on chain"
      - "Check contract is USDT or TRC20 compatible"
      - "Validate contract ABI"
  
  validate_amount:
    description: "Validate transfer amount"
    steps:
      - "Check amount > 0"
      - "Verify amount within limits"
      - "Check decimal precision"
  
  check_balance:
    description: "Check wallet balance"
    steps:
      - "Query current balance"
      - "Compare with transfer amount"
      - "Suggest alternative amounts"
  
  retry_transfer:
    description: "Retry failed transfer"
    steps:
      - "Verify transaction parameters"
      - "Check network status"
      - "Retry with exponential backoff"
  
  wait_confirmation:
    description: "Wait for transaction confirmation"
    steps:
      - "Monitor block progression"
      - "Check transaction status"
      - "Verify confirmation count"
  
  retry_contract_call:
    description: "Retry contract call"
    steps:
      - "Validate contract parameters"
      - "Check contract state"
      - "Retry with backoff"
  
  reconnect_database:
    description: "Reconnect to database"
    steps:
      - "Check database connectivity"
      - "Verify credentials"
      - "Reconnect with backoff"
