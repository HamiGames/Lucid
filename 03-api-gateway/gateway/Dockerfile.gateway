FROM nginx:1.27-alpine

RUN rm -f /etc/nginx/conf.d/default.conf
RUN printf '%s\n' \
  'server {' \
  '  listen 8080;' \
  '  location = /gateway/health { return 200 "ok\n"; }' \
  '  location / {' \
  '    proxy_set_header Host $host;' \
  '    proxy_set_header X-Real-IP $remote_addr;' \
  '    proxy_pass http://lucid_api:8081;' \
  '  }' \
  '}' > /etc/nginx/conf.d/lucid.conf

EXPOSE 8080
CMD ["nginx","-g","daemon off;"]
