# Lucid Session Anchoring Service Configuration
# Purpose: Centralize operational settings for the session-anchoring container
# Aligns with docker-compose.core.yml (service session-anchoring) and foundation services

service:
  name: session-anchoring
  host: "${SESSION_ANCHORING_HOST:-0.0.0.0}"
  port: ${SESSION_ANCHORING_PORT:-8085}
  url: "${SESSION_ANCHORING_URL:-http://session-anchoring:8085}"
  environment: "${LUCID_ENV:-production}"
  platform: "${LUCID_PLATFORM:-arm64}"

dependencies:
  mongodb_url: "${MONGO_URL:-${MONGODB_URL}}"
  on_system_chain_rpc: "${ON_SYSTEM_CHAIN_RPC:-${ON_SYSTEM_CHAIN_RPC_URL}}"
  lucid_anchors_address: "${LUCID_ANCHORS_ADDRESS}"
  lucid_chunk_store_address: "${LUCID_CHUNK_STORE_ADDRESS}"
  healthcheck:
    path: /health
    interval_seconds: 30
    timeout_seconds: 10
    retries: 3
    start_period_seconds: 60

storage:
  data_path: /app/data
  logs_path: /app/logs
  ensure_permissions: true
  owner: "65532:65532"
  collection_name: "session_anchorings"
  database_name: "lucid"

anchoring:
  enabled: true
  auto_anchor_on_session_complete: true
  batch_size: 100
  batch_timeout_seconds: 300
  verification_enabled: true
  require_confirmation_blocks: 6
  gas_limit_per_anchor: 90000
  max_gas_price: 1000000000

merkle_tree:
  enabled: true
  tree_depth: 20
  leaf_hash_algorithm: "blake3"
  root_hash_algorithm: "blake3"
  anchor_root_only: true
  include_proof_paths: true

verification:
  on_chain:
    enabled: true
    verify_after_anchor: true
    verification_timeout_seconds: 60
    retry_verification_on_failure: true
    max_verification_retries: 3
  off_chain:
    enabled: true
    verify_merkle_proofs: true
    verify_chunk_hashes: true
    cache_verification_results: true
    cache_ttl_seconds: 3600

api:
  base_path: /api/v1
  endpoints:
    anchor_session: /anchor
    status: /status/{session_id}
    verify: /verify/{session_id}
    health: /health
    metrics: /metrics

rate_limits:
  enabled: true
  window_seconds: 60
  max_requests: 500

security:
  user: 65532
  group: 65532
  read_only_root: true
  require_authentication: true
  require_authorization: true
  allowed_roles: ["USER", "NODE_OPERATOR", "ADMIN", "SUPER_ADMIN"]

monitoring:
  metrics_enabled: true
  expose_health: true
  expose_metrics: false
  track_anchoring_latency: true
  track_verification_success_rate: true

logging:
  directory: /app/logs
  level: INFO
  format: standard
  rotate:
    enabled: true
    max_size_mb: 10
    backups: 5

