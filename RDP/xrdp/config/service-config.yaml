# XRDP Service Enhanced Configuration
# File: RDP/xrdp/config/service-config.yaml
# Purpose: Enhanced service configuration with detailed settings for rdp-xrdp container
# NOTE: This extends the base config.yaml with operational and integration settings

# Service Metadata
service:
  name: "lucid-rdp-xrdp"
  version: "1.0.0"
  description: "XRDP service management API for Lucid system"
  cluster: "application"
  platform: "arm64"
  environment: "production"  # Override with LUCID_ENV env var

# Network Configuration
network:
  bind_address: "0.0.0.0"  # Always 0.0.0.0 in container
  port: 3389  # Override with XRDP_PORT env var
  service_host: "rdp-xrdp"  # Service name for internal communication
  service_url: "http://rdp-xrdp:3389"  # Override with RDP_XRDP_URL env var
  cors:
    enabled: true
    origins: ["*"]  # Override with CORS_ORIGINS env var (comma-separated)
    allow_credentials: true
    allow_methods: ["*"]
    allow_headers: ["*"]
    max_age: 3600

# Database Configuration
database:
  mongodb:
    url: ""  # REQUIRED: Set via MONGODB_URL env var
    database: "lucid"
    collection_prefix: "xrdp_"
    connection_pool_size: 50
    connection_timeout_ms: 10000
    server_selection_timeout_ms: 5000
    socket_timeout_ms: 20000
    retry_writes: true
    retry_reads: true
  
  redis:
    url: ""  # REQUIRED: Set via REDIS_URL env var
    database: 0
    connection_pool_size: 50
    socket_timeout: 5
    socket_connect_timeout: 5
    retry_on_timeout: true
    health_check_interval: 30

# Process Management
process_management:
  max_processes: 10  # Maximum concurrent XRDP processes
  process_timeout_seconds: 30  # Process startup timeout
  process_cleanup_interval_seconds: 300  # Cleanup stale processes
  process_health_check_interval_seconds: 30  # Health check interval
  auto_restart_failed_processes: false  # Auto-restart failed processes
  max_restart_attempts: 3  # Maximum restart attempts
  process_graceful_shutdown_timeout_seconds: 10  # Graceful shutdown timeout

# Resource Limits
resource_limits:
  max_memory_per_process_mb: 512  # Maximum memory per process
  max_cpu_percent_per_process: 50  # Maximum CPU per process (%)
  max_disk_usage_per_process_gb: 10  # Maximum disk usage per process
  total_memory_limit_mb: 2048  # Total memory limit for all processes
  total_cpu_limit_percent: 80  # Total CPU limit for all processes

# Storage Configuration
storage:
  config_path: "/app/config"  # XRDP configuration files
  log_path: "/app/logs"  # Log files
  session_path: "/app/data/sessions"  # Session data
  temp_path: "/tmp/xrdp"  # Temporary files
  cleanup_interval_seconds: 3600  # Cleanup interval
  retention_days: 30  # File retention period
  max_config_files: 100  # Maximum configuration files
  max_log_files: 50  # Maximum log files per process

# Security Configuration
security:
  ssl_enabled: false  # Enable SSL/TLS
  security_level: "high"  # Options: low, medium, high, maximum
  allowed_origins: ["*"]  # CORS allowed origins
  rate_limiting:
    enabled: true
    requests_per_minute: 60
    burst_size: 10
  authentication:
    enabled: false  # Enable API authentication
    token_header: "Authorization"
    token_prefix: "Bearer"

# Integration Services
integration:
  api_gateway:
    url: "http://api-gateway:8080"  # Override with API_GATEWAY_URL env var
    timeout_seconds: 30
    retry_count: 3
    retry_delay_seconds: 1.0
  
  auth_service:
    url: "http://lucid-auth-service:8089"  # Override with AUTH_SERVICE_URL env var
    timeout_seconds: 30
    retry_count: 3
    retry_delay_seconds: 1.0
  
  session_controller:
    url: "http://rdp-controller:8092"  # Override with SESSION_CONTROLLER_URL env var
    timeout_seconds: 30
    retry_count: 3
    retry_delay_seconds: 1.0
  
  # Default service call settings
  default_timeout_seconds: 30
  default_retry_count: 3
  default_retry_delay_seconds: 1.0

# Health Check Configuration
health_check:
  enabled: true
  interval_seconds: 30
  timeout_seconds: 10
  retries: 3
  start_period_seconds: 40
  endpoints:
    - path: "/health"
      method: "GET"
      expected_status: 200
    - path: "/services"
      method: "GET"
      expected_status: 200

# Monitoring Configuration
monitoring:
  metrics_enabled: true
  metrics_port: 9090
  metrics_path: "/metrics"
  scrape_interval_seconds: 30
  logging_level: "INFO"  # Override with LOG_LEVEL env var
  structured_logging: true
  debug: false  # Override with DEBUG env var

# XRDP Configuration Generation
xrdp_config:
  default_security_level: "high"
  ssl_enabled: false
  default_port_range:
    start: 13389
    end: 14389
  default_display_config:
    width: 1920
    height: 1080
    depth: 24
  config_template_path: "/app/config/templates"
  validation_enabled: true
  auto_cleanup: true
  cleanup_after_days: 7

# Error Handling
error_handling:
  include_stack_trace: false  # Include stack traces in error responses (production: false)
  log_errors: true
  log_level: "ERROR"
  retry_on_error: true
  max_retry_attempts: 3
  retry_delay_seconds: 1.0

# Performance Tuning
performance:
  async_workers: 4  # Number of async workers
  max_concurrent_requests: 100  # Maximum concurrent requests
  request_timeout_seconds: 30  # Request timeout
  keepalive_timeout_seconds: 5  # Keepalive timeout
  max_request_size_mb: 10  # Maximum request size
  compression_enabled: true  # Enable response compression
  compression_level: 6  # Compression level (1-9)

# Feature Flags
features:
  process_management: true
  config_management: true
  statistics: true
  health_check: true
  metrics: true
  logging: true
  api_documentation: true  # Enable /docs and /redoc endpoints

