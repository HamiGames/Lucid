{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "XRDP Service Operational Configuration",
  "description": "Runtime operational settings for rdp-xrdp container",
  "type": "object",
  "properties": {
    "service": {
      "type": "object",
      "description": "Service identification and metadata",
      "properties": {
        "name": {
          "type": "string",
          "default": "lucid-rdp-xrdp",
          "description": "Service name"
        },
        "version": {
          "type": "string",
          "default": "1.0.0",
          "description": "Service version"
        },
        "environment": {
          "type": "string",
          "enum": ["development", "staging", "production"],
          "default": "production",
          "description": "Deployment environment"
        }
      },
      "required": ["name", "version"]
    },
    "process_management": {
      "type": "object",
      "description": "XRDP process lifecycle management settings",
      "properties": {
        "max_processes": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 10,
          "description": "Maximum concurrent XRDP processes"
        },
        "process_timeout_seconds": {
          "type": "integer",
          "minimum": 10,
          "maximum": 300,
          "default": 30,
          "description": "Process startup timeout in seconds"
        },
        "process_cleanup_interval_seconds": {
          "type": "integer",
          "minimum": 60,
          "maximum": 3600,
          "default": 300,
          "description": "Interval for cleaning up stale processes"
        },
        "process_health_check_interval_seconds": {
          "type": "integer",
          "minimum": 10,
          "maximum": 300,
          "default": 30,
          "description": "Interval for checking process health"
        },
        "auto_restart_failed_processes": {
          "type": "boolean",
          "default": false,
          "description": "Automatically restart failed processes"
        },
        "max_restart_attempts": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "default": 3,
          "description": "Maximum restart attempts for failed processes"
        }
      },
      "required": ["max_processes", "process_timeout_seconds"]
    },
    "resource_limits": {
      "type": "object",
      "description": "Resource limits and constraints",
      "properties": {
        "max_memory_per_process_mb": {
          "type": "integer",
          "minimum": 64,
          "maximum": 4096,
          "default": 512,
          "description": "Maximum memory per XRDP process in MB"
        },
        "max_cpu_percent_per_process": {
          "type": "number",
          "minimum": 10,
          "maximum": 100,
          "default": 50,
          "description": "Maximum CPU usage per process (percentage)"
        },
        "max_disk_usage_per_process_gb": {
          "type": "number",
          "minimum": 1,
          "maximum": 100,
          "default": 10,
          "description": "Maximum disk usage per process in GB"
        }
      }
    },
    "network": {
      "type": "object",
      "description": "Network configuration",
      "properties": {
        "bind_address": {
          "type": "string",
          "default": "0.0.0.0",
          "description": "Bind address (always 0.0.0.0 in container)"
        },
        "port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "default": 3389,
          "description": "Service port"
        },
        "connection_timeout_seconds": {
          "type": "integer",
          "minimum": 5,
          "maximum": 300,
          "default": 30,
          "description": "Connection timeout in seconds"
        },
        "keepalive_interval_seconds": {
          "type": "integer",
          "minimum": 10,
          "maximum": 300,
          "default": 60,
          "description": "Keepalive interval in seconds"
        }
      },
      "required": ["bind_address", "port"]
    },
    "security": {
      "type": "object",
      "description": "Security configuration",
      "properties": {
        "ssl_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable SSL/TLS encryption"
        },
        "security_level": {
          "type": "string",
          "enum": ["low", "medium", "high", "maximum"],
          "default": "high",
          "description": "Security level for XRDP configurations"
        },
        "allowed_origins": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": ["*"],
          "description": "CORS allowed origins"
        },
        "rate_limiting": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "requests_per_minute": {
              "type": "integer",
              "minimum": 10,
              "maximum": 1000,
              "default": 60
            }
          }
        }
      }
    },
    "monitoring": {
      "type": "object",
      "description": "Monitoring and observability settings",
      "properties": {
        "metrics_enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable metrics collection"
        },
        "metrics_port": {
          "type": "integer",
          "minimum": 1024,
          "maximum": 65535,
          "default": 9090,
          "description": "Prometheus metrics port"
        },
        "health_check_enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable health check endpoint"
        },
        "health_check_interval_seconds": {
          "type": "integer",
          "minimum": 10,
          "maximum": 300,
          "default": 30,
          "description": "Health check interval"
        },
        "logging_level": {
          "type": "string",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"],
          "default": "INFO",
          "description": "Logging level"
        },
        "structured_logging": {
          "type": "boolean",
          "default": true,
          "description": "Enable structured JSON logging"
        }
      }
    },
    "storage": {
      "type": "object",
      "description": "Storage configuration",
      "properties": {
        "config_path": {
          "type": "string",
          "default": "/app/config",
          "description": "Path to XRDP configuration files"
        },
        "log_path": {
          "type": "string",
          "default": "/app/logs",
          "description": "Path to log files"
        },
        "session_path": {
          "type": "string",
          "default": "/app/data/sessions",
          "description": "Path to session data"
        },
        "temp_path": {
          "type": "string",
          "default": "/tmp/xrdp",
          "description": "Path to temporary files"
        },
        "cleanup_interval_seconds": {
          "type": "integer",
          "minimum": 300,
          "maximum": 86400,
          "default": 3600,
          "description": "Interval for cleaning up old files"
        },
        "retention_days": {
          "type": "integer",
          "minimum": 1,
          "maximum": 365,
          "default": 30,
          "description": "File retention period in days"
        }
      }
    },
    "integration": {
      "type": "object",
      "description": "Service integration settings",
      "properties": {
        "api_gateway_url": {
          "type": "string",
          "default": "http://api-gateway:8080",
          "description": "API Gateway URL"
        },
        "auth_service_url": {
          "type": "string",
          "default": "http://lucid-auth-service:8089",
          "description": "Auth Service URL"
        },
        "session_controller_url": {
          "type": "string",
          "default": "http://rdp-controller:8092",
          "description": "Session Controller URL"
        },
        "service_timeout_seconds": {
          "type": "integer",
          "minimum": 5,
          "maximum": 300,
          "default": 30,
          "description": "Service call timeout"
        },
        "service_retry_count": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "default": 3,
          "description": "Service call retry count"
        },
        "service_retry_delay_seconds": {
          "type": "number",
          "minimum": 0.1,
          "maximum": 10,
          "default": 1.0,
          "description": "Delay between retries"
        }
      }
    }
  },
  "required": [
    "service",
    "process_management",
    "network"
  ]
}

