{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "XRDP Service Health Check Configuration",
  "description": "Detailed health check configuration for rdp-xrdp container",
  "type": "object",
  "properties": {
    "health_check": {
      "type": "object",
      "description": "Main health check configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable health check endpoint"
        },
        "endpoint": {
          "type": "string",
          "default": "/health",
          "description": "Health check endpoint path"
        },
        "interval_seconds": {
          "type": "integer",
          "minimum": 10,
          "maximum": 300,
          "default": 30,
          "description": "Health check interval in seconds"
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 5,
          "maximum": 60,
          "default": 10,
          "description": "Health check timeout in seconds"
        },
        "retries": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 3,
          "description": "Number of retry attempts"
        },
        "start_period_seconds": {
          "type": "integer",
          "minimum": 0,
          "maximum": 300,
          "default": 40,
          "description": "Start period before health checks begin"
        }
      },
      "required": ["enabled", "endpoint", "interval_seconds", "timeout_seconds"]
    },
    "checks": {
      "type": "object",
      "description": "Individual health check components",
      "properties": {
        "service_initialization": {
          "type": "object",
          "description": "Service initialization check",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "required": {
              "type": "boolean",
              "default": true
            },
            "timeout_seconds": {
              "type": "integer",
              "default": 5
            }
          }
        },
        "database_mongodb": {
          "type": "object",
          "description": "MongoDB connection check",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "required": {
              "type": "boolean",
              "default": true
            },
            "timeout_seconds": {
              "type": "integer",
              "default": 5
            },
            "check_query": {
              "type": "boolean",
              "default": true,
              "description": "Perform actual query to verify connection"
            }
          }
        },
        "database_redis": {
          "type": "object",
          "description": "Redis connection check",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "required": {
              "type": "boolean",
              "default": true
            },
            "timeout_seconds": {
              "type": "integer",
              "default": 5
            },
            "check_ping": {
              "type": "boolean",
              "default": true,
              "description": "Perform PING command to verify connection"
            }
          }
        },
        "process_manager": {
          "type": "object",
          "description": "Process manager initialization check",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "required": {
              "type": "boolean",
              "default": true
            },
            "timeout_seconds": {
              "type": "integer",
              "default": 5
            }
          }
        },
        "config_manager": {
          "type": "object",
          "description": "Configuration manager initialization check",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "required": {
              "type": "boolean",
              "default": true
            },
            "timeout_seconds": {
              "type": "integer",
              "default": 5
            }
          }
        },
        "storage_paths": {
          "type": "object",
          "description": "Storage paths accessibility check",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "required": {
              "type": "boolean",
              "default": false
            },
            "timeout_seconds": {
              "type": "integer",
              "default": 5
            },
            "check_paths": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": [
                "/app/config",
                "/app/logs",
                "/app/data/sessions",
                "/tmp/xrdp"
              ]
            }
          }
        },
        "active_processes": {
          "type": "object",
          "description": "Active processes status check",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "required": {
              "type": "boolean",
              "default": false
            },
            "max_processes": {
              "type": "integer",
              "default": 10
            },
            "warning_threshold": {
              "type": "number",
              "default": 0.8,
              "description": "Warning if processes exceed this percentage of max"
            }
          }
        }
      }
    },
    "response_format": {
      "type": "object",
      "description": "Health check response format",
      "properties": {
        "include_timestamp": {
          "type": "boolean",
          "default": true
        },
        "include_version": {
          "type": "boolean",
          "default": true
        },
        "include_checks": {
          "type": "boolean",
          "default": true,
          "description": "Include individual check results"
        },
        "include_metrics": {
          "type": "boolean",
          "default": false,
          "description": "Include basic metrics in response"
        }
      }
    },
    "status_codes": {
      "type": "object",
      "description": "HTTP status codes for health check responses",
      "properties": {
        "healthy": {
          "type": "integer",
          "default": 200,
          "description": "Status code when service is healthy"
        },
        "degraded": {
          "type": "integer",
          "default": 200,
          "description": "Status code when service is degraded but functional"
        },
        "unhealthy": {
          "type": "integer",
          "default": 503,
          "description": "Status code when service is unhealthy"
        },
        "not_initialized": {
          "type": "integer",
          "default": 503,
          "description": "Status code when service is not initialized"
        }
      }
    },
    "dependencies": {
      "type": "object",
      "description": "External service dependency checks",
      "properties": {
        "api_gateway": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "required": {
              "type": "boolean",
              "default": false
            },
            "url": {
              "type": "string",
              "default": "http://api-gateway:8080/health"
            },
            "timeout_seconds": {
              "type": "integer",
              "default": 5
            }
          }
        },
        "auth_service": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "required": {
              "type": "boolean",
              "default": false
            },
            "url": {
              "type": "string",
              "default": "http://lucid-auth-service:8089/health"
            },
            "timeout_seconds": {
              "type": "integer",
              "default": 5
            }
          }
        }
      }
    }
  },
  "required": [
    "health_check",
    "checks"
  ]
}

