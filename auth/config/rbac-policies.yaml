# Lucid Authentication Service - RBAC Policies Configuration
# Optional YAML configuration for role-based access control policies
# File: auth/config/rbac-policies.yaml
# Purpose: Define RBAC roles, permissions, and policy rules

# RBAC Role Definitions
roles:
  USER:
    level: 1
    description: "Basic user with session operations"
    permissions:
      - CREATE_SESSION
      - VIEW_OWN_SESSIONS
      - DELETE_OWN_SESSIONS
      - VIEW_OWN_PROFILE
      - UPDATE_OWN_PROFILE
      - CONNECT_HARDWARE_WALLET
    default_kyc_status: "none"
    max_concurrent_sessions: 5
    session_timeout_minutes: 30

  NODE_OPERATOR:
    level: 2
    description: "Node operator with PoOT operations"
    inherits_from: USER
    additional_permissions:
      - REGISTER_NODE
      - MANAGE_OWN_NODES
      - VIEW_OWN_NODES
      - SUBMIT_POOT_VOTES
      - VIEW_OWN_PAYOUTS
      - REQUEST_PAYOUT
      - VIEW_POOL_INFO
    default_kyc_status: "pending"
    max_concurrent_sessions: 10
    session_timeout_minutes: 60

  ADMIN:
    level: 3
    description: "System administrator with management capabilities"
    inherits_from: NODE_OPERATOR
    additional_permissions:
      - VIEW_ALL_USERS
      - MANAGE_USERS
      - VIEW_ALL_SESSIONS
      - DELETE_ANY_SESSION
      - VIEW_BLOCKCHAIN_INFO
      - VIEW_ALL_NODES
      - MANAGE_POOLS
      - VIEW_SYSTEM_METRICS
      - ACCESS_ADMIN_DASHBOARD
      - VIEW_AUDIT_LOGS
      - MANAGE_TRUST_POLICIES
    default_kyc_status: "verified"
    max_concurrent_sessions: 20
    session_timeout_minutes: 120

  SUPER_ADMIN:
    level: 4
    description: "Super administrator with full system access"
    inherits_from: ADMIN
    additional_permissions:
      - "*"  # All permissions
    default_kyc_status: "verified"
    max_concurrent_sessions: -1  # Unlimited
    session_timeout_minutes: -1  # No timeout

# Permission Definitions
permissions:
  # Session Permissions
  CREATE_SESSION:
    description: "Create new RDP session"
    category: "session"
    requires_kyc: false

  VIEW_OWN_SESSIONS:
    description: "View own active sessions"
    category: "session"
    requires_kyc: false

  DELETE_OWN_SESSIONS:
    description: "Terminate own sessions"
    category: "session"
    requires_kyc: false

  VIEW_ALL_SESSIONS:
    description: "View all user sessions (admin)"
    category: "session"
    requires_kyc: true
    requires_role: "ADMIN"

  DELETE_ANY_SESSION:
    description: "Terminate any session (admin)"
    category: "session"
    requires_kyc: true
    requires_role: "ADMIN"

  # User Profile Permissions
  VIEW_OWN_PROFILE:
    description: "View own user profile"
    category: "profile"
    requires_kyc: false

  UPDATE_OWN_PROFILE:
    description: "Update own user profile"
    category: "profile"
    requires_kyc: false

  VIEW_ALL_USERS:
    description: "View all users (admin)"
    category: "profile"
    requires_kyc: true
    requires_role: "ADMIN"

  MANAGE_USERS:
    description: "Manage user accounts (admin)"
    category: "profile"
    requires_kyc: true
    requires_role: "ADMIN"

  # Hardware Wallet Permissions
  CONNECT_HARDWARE_WALLET:
    description: "Connect hardware wallet for authentication"
    category: "hardware_wallet"
    requires_kyc: false

  # Node Operations Permissions
  REGISTER_NODE:
    description: "Register new node"
    category: "node"
    requires_kyc: true
    requires_role: "NODE_OPERATOR"

  MANAGE_OWN_NODES:
    description: "Manage own registered nodes"
    category: "node"
    requires_kyc: true
    requires_role: "NODE_OPERATOR"

  VIEW_OWN_NODES:
    description: "View own nodes"
    category: "node"
    requires_kyc: true
    requires_role: "NODE_OPERATOR"

  VIEW_ALL_NODES:
    description: "View all nodes (admin)"
    category: "node"
    requires_kyc: true
    requires_role: "ADMIN"

  # PoOT Permissions
  SUBMIT_POOT_VOTES:
    description: "Submit Proof of Ownership Trust votes"
    category: "poot"
    requires_kyc: true
    requires_role: "NODE_OPERATOR"

  # Payout Permissions
  VIEW_OWN_PAYOUTS:
    description: "View own payout history"
    category: "payout"
    requires_kyc: true
    requires_role: "NODE_OPERATOR"

  REQUEST_PAYOUT:
    description: "Request TRON payout"
    category: "payout"
    requires_kyc: true
    requires_role: "NODE_OPERATOR"

  VIEW_POOL_INFO:
    description: "View pool information"
    category: "payout"
    requires_kyc: true
    requires_role: "NODE_OPERATOR"

  # Blockchain Permissions
  VIEW_BLOCKCHAIN_INFO:
    description: "View blockchain information (admin)"
    category: "blockchain"
    requires_kyc: true
    requires_role: "ADMIN"

  # Pool Management Permissions
  MANAGE_POOLS:
    description: "Manage payout pools (admin)"
    category: "pool"
    requires_kyc: true
    requires_role: "ADMIN"

  # System Permissions
  VIEW_SYSTEM_METRICS:
    description: "View system metrics (admin)"
    category: "system"
    requires_kyc: true
    requires_role: "ADMIN"

  ACCESS_ADMIN_DASHBOARD:
    description: "Access admin dashboard"
    category: "system"
    requires_kyc: true
    requires_role: "ADMIN"

  VIEW_AUDIT_LOGS:
    description: "View audit logs (admin)"
    category: "system"
    requires_kyc: true
    requires_role: "ADMIN"

  MANAGE_TRUST_POLICIES:
    description: "Manage trust policies (admin)"
    category: "system"
    requires_kyc: true
    requires_role: "ADMIN"

# Policy Rules
policy_rules:
  # KYC Requirements
  kyc_requirements:
    - permission: "REGISTER_NODE"
      required_kyc_status: "verified"
    - permission: "REQUEST_PAYOUT"
      required_kyc_status: "verified"
    - permission: "SUBMIT_POOT_VOTES"
      required_kyc_status: "pending"

  # Rate Limiting by Role
  rate_limits:
    USER:
      requests_per_minute: 100
      burst_limit: 20
    NODE_OPERATOR:
      requests_per_minute: 500
      burst_limit: 50
    ADMIN:
      requests_per_minute: 1000
      burst_limit: 100
    SUPER_ADMIN:
      requests_per_minute: 10000
      burst_limit: 1000

  # Session Limits
  session_limits:
    USER:
      max_concurrent: 5
      max_duration_hours: 24
      idle_timeout_minutes: 30
    NODE_OPERATOR:
      max_concurrent: 10
      max_duration_hours: 48
      idle_timeout_minutes: 60
    ADMIN:
      max_concurrent: 20
      max_duration_hours: 168  # 7 days
      idle_timeout_minutes: 120
    SUPER_ADMIN:
      max_concurrent: -1  # Unlimited
      max_duration_hours: -1  # Unlimited
      idle_timeout_minutes: -1  # No timeout

# Trust Policy Configuration
trust_policies:
  default_trust_level: 0.5
  trust_thresholds:
    verified_kyc: 0.8
    hardware_wallet: 0.9
    node_operator: 0.7
    admin_verified: 1.0

# Audit Configuration
audit:
  enabled: true
  log_all_permission_checks: false
  log_failed_checks: true
  log_admin_actions: true
  retention_days: 90

