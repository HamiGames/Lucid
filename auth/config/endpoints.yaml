# Lucid Authentication Service - HTTP Endpoint Configuration
# File: auth/config/endpoints.yaml
# Purpose: Customizable endpoint configuration for authentication service
# All endpoints can be enabled/disabled and customized via this file

# Endpoint Groups
endpoints:
  # System Endpoints
  health:
    enabled: true
    path: "/health"
    methods: ["GET"]
    description: "Health check endpoint for Docker healthcheck"
    rate_limit: null  # No rate limit for health checks
    authentication_required: false
    
  meta:
    enabled: true
    path: "/meta/info"
    methods: ["GET"]
    description: "Service metadata and information"
    rate_limit: 60  # 60 requests per minute
    authentication_required: false
    
  root:
    enabled: true
    path: "/"
    methods: ["GET"]
    description: "API root endpoint"
    rate_limit: 60
    authentication_required: false
  
  # Authentication Endpoints
  auth:
    enabled: true
    path: "/auth"
    methods: ["POST"]
    description: "Authentication endpoints group"
    rate_limit: 30  # 30 requests per minute
    authentication_required: false
    sub_endpoints:
      register:
        enabled: true
        path: "/auth/register"
        methods: ["POST"]
        description: "Register new user"
        rate_limit: 10  # 10 registrations per minute
        authentication_required: false
        
      login:
        enabled: true
        path: "/auth/login"
        methods: ["POST"]
        description: "Login with TRON signature"
        rate_limit: 20  # 20 login attempts per minute
        authentication_required: false
        
      refresh:
        enabled: true
        path: "/auth/refresh"
        methods: ["POST"]
        description: "Refresh access token"
        rate_limit: 30
        authentication_required: false
        
      logout:
        enabled: true
        path: "/auth/logout"
        methods: ["POST"]
        description: "Logout and revoke session"
        rate_limit: 30
        authentication_required: true
        
      verify:
        enabled: true
        path: "/auth/verify"
        methods: ["POST"]
        description: "Verify JWT token validity"
        rate_limit: 60
        authentication_required: false
  
  # User Management Endpoints
  users:
    enabled: true
    path: "/users"
    methods: ["GET", "PUT"]
    description: "User management endpoints"
    rate_limit: 100  # 100 requests per minute
    authentication_required: true
    sub_endpoints:
      get_current:
        enabled: true
        path: "/users/me"
        methods: ["GET"]
        description: "Get current authenticated user"
        rate_limit: 60
        authentication_required: true
        
      get_by_id:
        enabled: true
        path: "/users/{user_id}"
        methods: ["GET"]
        description: "Get user by ID"
        rate_limit: 60
        authentication_required: true
        
      update:
        enabled: true
        path: "/users/{user_id}"
        methods: ["PUT"]
        description: "Update user profile"
        rate_limit: 30
        authentication_required: true
  
  # Session Management Endpoints
  sessions:
    enabled: true
    path: "/sessions"
    methods: ["GET", "DELETE"]
    description: "Session management endpoints"
    rate_limit: 100
    authentication_required: true
    sub_endpoints:
      list:
        enabled: true
        path: "/sessions"
        methods: ["GET"]
        description: "List all active sessions for current user"
        rate_limit: 60
        authentication_required: true
        
      get_by_id:
        enabled: true
        path: "/sessions/{session_id}"
        methods: ["GET"]
        description: "Get session by ID"
        rate_limit: 60
        authentication_required: true
        
      revoke:
        enabled: true
        path: "/sessions/{session_id}"
        methods: ["DELETE"]
        description: "Revoke specific session"
        rate_limit: 30
        authentication_required: true
        
      revoke_all:
        enabled: true
        path: "/sessions"
        methods: ["DELETE"]
        description: "Revoke all sessions for current user"
        rate_limit: 10  # Limit revoke all operations
        authentication_required: true
  
  # Hardware Wallet Endpoints
  hardware_wallet:
    enabled: true
    path: "/hw"
    methods: ["POST", "GET", "DELETE"]
    description: "Hardware wallet integration endpoints"
    rate_limit: 60
    authentication_required: true
    sub_endpoints:
      connect:
        enabled: true
        path: "/hw/connect"
        methods: ["POST"]
        description: "Connect hardware wallet (Ledger, Trezor, KeepKey)"
        rate_limit: 10
        authentication_required: true
        
      sign:
        enabled: true
        path: "/hw/sign"
        methods: ["POST"]
        description: "Sign message with hardware wallet"
        rate_limit: 30
        authentication_required: true
        
      status:
        enabled: true
        path: "/hw/status/{wallet_id}"
        methods: ["GET"]
        description: "Get hardware wallet connection status"
        rate_limit: 60
        authentication_required: true
        
      disconnect:
        enabled: true
        path: "/hw/disconnect/{wallet_id}"
        methods: ["POST"]
        description: "Disconnect hardware wallet"
        rate_limit: 30
        authentication_required: true
  
  # Service Orchestration Endpoints
  orchestration:
    enabled: false  # Disabled by default - requires ENABLE_SERVICE_ORCHESTRATION=true
    path: "/orchestrate"
    methods: ["GET", "POST", "DELETE"]
    description: "Service orchestration endpoints (spawning, cloning, managing services)"
    rate_limit: 10  # Limit orchestration operations
    authentication_required: true
    requires_role: "ADMIN"  # Requires ADMIN or SUPER_ADMIN role
    sub_endpoints:
      spawn_mongodb_clone:
        enabled: false
        path: "/orchestrate/mongodb/clone"
        methods: ["POST"]
        description: "Spawn MongoDB clone instance for a node"
        rate_limit: 5  # Very limited - resource intensive
        authentication_required: true
        requires_permission: "SPAWN_SERVICES"
        
      list_mongodb_clones:
        enabled: false
        path: "/orchestrate/mongodb/clones"
        methods: ["GET"]
        description: "List all MongoDB clones"
        rate_limit: 30
        authentication_required: true
        requires_permission: "VIEW_SPAWNED_SERVICES"
        
      get_mongodb_clone:
        enabled: false
        path: "/orchestrate/mongodb/clones/{node_id}"
        methods: ["GET"]
        description: "Get MongoDB clone information for a node"
        rate_limit: 30
        authentication_required: true
        requires_permission: "VIEW_SPAWNED_SERVICES"
        
      remove_mongodb_clone:
        enabled: false
        path: "/orchestrate/mongodb/clones/{node_id}"
        methods: ["DELETE"]
        description: "Remove MongoDB clone for a node"
        rate_limit: 10
        authentication_required: true
        requires_permission: "MANAGE_SERVICE_LIFECYCLE"
        
      check_mongodb_clone_health:
        enabled: false
        path: "/orchestrate/mongodb/clones/{node_id}/health"
        methods: ["GET"]
        description: "Check health of MongoDB clone"
        rate_limit: 60
        authentication_required: true
        requires_permission: "VIEW_SPAWNED_SERVICES"
        
      list_spawned_services:
        enabled: false
        path: "/orchestrate/services/spawned"
        methods: ["GET"]
        description: "List all spawned services"
        rate_limit: 30
        authentication_required: true
        requires_permission: "VIEW_SPAWNED_SERVICES"
        
      get_service_status:
        enabled: false
        path: "/orchestrate/services/{service_id}/status"
        methods: ["GET"]
        description: "Get status of a spawned service"
        rate_limit: 60
        authentication_required: true
        requires_permission: "VIEW_SPAWNED_SERVICES"
        
      remove_service:
        enabled: false
        path: "/orchestrate/services/{service_id}"
        methods: ["DELETE"]
        description: "Remove a spawned service"
        rate_limit: 10
        authentication_required: true
        requires_permission: "MANAGE_SERVICE_LIFECYCLE"

# Endpoint Customization Options
customization:
  # CORS Configuration
  cors:
    enabled: true
    allow_origins: ["*"]  # Configure per environment
    allow_credentials: true
    allow_methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
    allow_headers: ["*"]
    max_age: 3600
  
  # Response Format
  response_format:
    include_timestamp: true
    include_request_id: true
    error_format: "standard"  # standard, detailed, minimal
  
  # Rate Limiting
  rate_limiting:
    enabled: true
    default_limit: 60  # requests per minute
    storage: "redis"  # redis, memory
    key_prefix: "auth:rate_limit:"
  
  # Request Validation
  validation:
    strict_mode: false  # Reject unknown fields
    max_request_size: 1048576  # 1MB
    timeout: 30  # seconds
  
  # Logging
  logging:
    log_requests: true
    log_responses: false  # Don't log response bodies (may contain sensitive data)
    log_errors: true
    log_level: "INFO"

